<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>install NVIDIA supported docker</title><script src=/js/if_mobile.js></script>
<script>!function(){$("pre > code").each(function(){var s,n=$(this).parent().attr("class");n==null||n===""?$(this).addClass("hljs"):(s={js:"javascript"},s[n]&&(n=s[n]),$(this).addClass(n))})}</script><link rel=stylesheet href=/css/hljs/snazzy.css><link rel=stylesheet href=/css/hljs/line-numbers.min.css><script src=/js/hljs/highlight.min.js></script>
<script src=/js/hljs/highlightjs-line-numbers.min.js></script>
<script>hljs.highlightAll()</script><script>hljs.initLineNumbersOnLoad()</script><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/footer.css><link rel=stylesheet href=/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=icon id=light-scheme-icon href=/favicons/favicon_B_Light.ico type=image/x-icon><link rel=icon id=dark-scheme-icon href=/favicons/favicon_B_Dark.ico type=image/x-icon><script src=/js/favicon.js></script></head><body><div class=container><div class=header><h1>install NVIDIA supported docker</h1>Mon, 2025-04-28<hr></div><div class=middle><div id=TitleWithToc><div id=TitleOfToc>install NVIDIA supported docker</div></div><div id=content><h2 id=docker>docker</h2><p><a href=https://docs.docker.com/engine/install/ubuntu/>official doc</a></p><h3 id=装>装</h3><div class=sourceCode id=cb1><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true></a><span class=co># 拷自 official doc</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true></a><span class=co># Add Docker&#39;s official GPG key:</span></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true></a><span class=fu>sudo</span> apt-get update</span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true></a><span class=fu>sudo</span> apt-get install ca-certificates curl</span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true></a><span class=fu>sudo</span> install -m 0755 -d /etc/apt/keyrings</span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true></a><span class=fu>sudo</span> curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc</span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true></a><span class=fu>sudo</span> chmod a+r /etc/apt/keyrings/docker.asc</span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true></a></span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true></a><span class=co># Add the repository to Apt sources:</span></span>
<span id=cb1-10><a href=#cb1-10 aria-hidden=true></a><span class=bu>echo</span> <span class=kw>\</span></span>
<span id=cb1-11><a href=#cb1-11 aria-hidden=true></a>  <span class=st>&quot;deb [arch=</span><span class=va>$(</span><span class=ex>dpkg</span> --print-architecture<span class=va>)</span><span class=st> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span></span>
<span id=cb1-12><a href=#cb1-12 aria-hidden=true></a><span class=st>  </span><span class=va>$(</span><span class=bu>.</span> <span class=ex>/etc/os-release</span> <span class=kw>&amp;&amp;</span> <span class=bu>echo</span> <span class=st>&quot;</span><span class=va>${UBUNTU_CODENAME:-$VERSION_CODENAME}</span><span class=st>&quot;</span><span class=va>)</span><span class=st> stable&quot;</span> <span class=kw>|</span> <span class=kw>\</span></span>
<span id=cb1-13><a href=#cb1-13 aria-hidden=true></a>  <span class=fu>sudo</span> tee /etc/apt/sources.list.d/docker.list <span class=op>&gt;</span> /dev/null</span>
<span id=cb1-14><a href=#cb1-14 aria-hidden=true></a><span class=fu>sudo</span> apt-get update</span>
<span id=cb1-15><a href=#cb1-15 aria-hidden=true></a></span>
<span id=cb1-16><a href=#cb1-16 aria-hidden=true></a><span class=fu>sudo</span> apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span></code></pre></div><h3 id=配>配</h3><h4 id=user-add-to-docker-group>user add to docker group</h4><div class=sourceCode id=cb2><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true></a><span class=ex>useradd</span> -a -G docker <span class=op>&lt;</span>username<span class=op>&gt;</span></span></code></pre></div><p>重登</p><h4 id=add-proxy>add proxy</h4><div class=sourceCode id=cb3><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb3-1><a href=#cb3-1 aria-hidden=true></a><span class=ex>systemctl</span> edit docker</span></code></pre></div><pre class=conf><code>[Service]
Environment=&quot;HTTP_PROXY=http://localhost:8118&quot;
Environment=&quot;HTTPS_PROXY=http://localhost:8118&quot;</code></pre><h2 id=nvidia>NVIDIA</h2><p>分两部分</p><ul><li>driver：host 机上要能操作 GPU (<a href=https://docs.nvidia.com/datacenter/tesla/driver-installation-guide/index.html>official doc</a>)</li><li>container：可以将 GPU 传递到 docker 内 (<a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html>official doc</a>)</li></ul><p>可以从 container 的 <a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html>official doc</a> 入手。</p><h3 id=driver>driver</h3><p>container 第一节给了一个链接跳转到 <a href=https://docs.nvidia.com/cuda/cuda-installation-guide-linux/>cuda-installation doc</a>，我们不需要在 host 机上装 cuda，所以点右边 <a href=https://docs.nvidia.com/cuda/cuda-installation-guide-linux/#driver-installation>4. Driver Installation</a>，直接给了个 <a href=https://docs.nvidia.com/datacenter/tesla/driver-installation-guide/index.html>tesla 的 driver installation doc</a></p><h4 id=先下-keyring>先下 keyring</h4><div class=sourceCode id=cb5><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb5-1><a href=#cb5-1 aria-hidden=true></a><span class=co># ubuntu2204/x86_64</span></span>
<span id=cb5-2><a href=#cb5-2 aria-hidden=true></a><span class=fu>wget</span> https://developer.download.nvidia.com/compute/cuda/repos/<span class=op>&lt;</span>distro<span class=op>&gt;</span>/<span class=op>&lt;</span>arch<span class=op>&gt;</span>/cuda-keyring_1.1-1_all.deb</span>
<span id=cb5-3><a href=#cb5-3 aria-hidden=true></a><span class=fu>sudo</span> dpkg -i cuda-keyring_1.1-1_all.deb</span></code></pre></div><h4 id=下>下</h4><p>选择开源还是闭源驱动可以看 <a href=https://docs.nvidia.com/datacenter/tesla/driver-installation-guide/index.html#kernel-modules>5. Kernel Modules</a></p><p>新的是 open source 的 driver 的</p><div class=sourceCode id=cb6><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb6-1><a href=#cb6-1 aria-hidden=true></a><span class=fu>sudo</span> apt-get update</span>
<span id=cb6-2><a href=#cb6-2 aria-hidden=true></a><span class=ex>apt</span> install nvidia-open</span></code></pre></div><h4 id=验>验</h4><div class=sourceCode id=cb7><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb7-1><a href=#cb7-1 aria-hidden=true></a><span class=ex>nvidia-smi</span></span>
<span id=cb7-2><a href=#cb7-2 aria-hidden=true></a><span class=ex>reboot</span></span></code></pre></div><h3 id=nvidia-container-toolkit>NVIDIA Container Toolkit</h3><p><a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html>official doc</a></p><h4 id=装-1>装</h4><div class=sourceCode id=cb8><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb8-1><a href=#cb8-1 aria-hidden=true></a><span class=co># 拷自 official doc</span></span>
<span id=cb8-2><a href=#cb8-2 aria-hidden=true></a><span class=ex>curl</span> -fsSL https://nvidia.github.io/libnvidia-container/gpgkey <span class=kw>|</span> <span class=fu>sudo</span> gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg <span class=kw>\</span></span>
<span id=cb8-3><a href=#cb8-3 aria-hidden=true></a>  <span class=kw>&amp;&amp;</span> <span class=ex>curl</span> -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list <span class=kw>|</span> <span class=kw>\</span></span>
<span id=cb8-4><a href=#cb8-4 aria-hidden=true></a>    <span class=fu>sed</span> <span class=st>&#39;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#39;</span> <span class=kw>|</span> <span class=kw>\</span></span>
<span id=cb8-5><a href=#cb8-5 aria-hidden=true></a>    <span class=fu>sudo</span> tee /etc/apt/sources.list.d/nvidia-container-toolkit.list</span>
<span id=cb8-6><a href=#cb8-6 aria-hidden=true></a><span class=fu>sed</span> -i -e <span class=st>&#39;/experimental/ s/^#//g&#39;</span> /etc/apt/sources.list.d/nvidia-container-toolkit.list</span>
<span id=cb8-7><a href=#cb8-7 aria-hidden=true></a><span class=fu>sudo</span> apt-get update</span>
<span id=cb8-8><a href=#cb8-8 aria-hidden=true></a><span class=fu>sudo</span> apt-get install -y nvidia-container-toolkit</span></code></pre></div><h3 id=配-1>配</h3><h4 id=nvidia-container-runtime>nvidia-container-runtime</h4><div class=sourceCode id=cb9><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb9-1><a href=#cb9-1 aria-hidden=true></a><span class=co># 拷自 official doc</span></span>
<span id=cb9-2><a href=#cb9-2 aria-hidden=true></a><span class=fu>sudo</span> nvidia-ctk runtime configure --runtime=docker</span>
<span id=cb9-3><a href=#cb9-3 aria-hidden=true></a><span class=co># /etc/docker/daemon.json</span></span></code></pre></div><h4 id=btrfs>btrfs</h4><p><code>/etc/docker/daemon.json</code></p><div class=sourceCode id=cb10><pre class="sourceCode json"><code class="sourceCode json"><span id=cb10-1><a href=#cb10-1 aria-hidden=true></a><span class=fu>{</span></span>
<span id=cb10-2><a href=#cb10-2 aria-hidden=true></a>    <span class=dt>&quot;storage-driver&quot;</span><span class=fu>:</span> <span class=st>&quot;btrfs&quot;</span></span>
<span id=cb10-3><a href=#cb10-3 aria-hidden=true></a><span class=fu>}</span></span></code></pre></div><h4 id=results>results</h4><p><code>/etc/docker/daemon.json</code></p><div class=sourceCode id=cb11><pre class="sourceCode json"><code class="sourceCode json"><span id=cb11-1><a href=#cb11-1 aria-hidden=true></a><span class=fu>{</span></span>
<span id=cb11-2><a href=#cb11-2 aria-hidden=true></a>    <span class=dt>&quot;storage-driver&quot;</span><span class=fu>:</span> <span class=st>&quot;btrfs&quot;</span><span class=fu>,</span></span>
<span id=cb11-3><a href=#cb11-3 aria-hidden=true></a>    <span class=dt>&quot;runtimes&quot;</span><span class=fu>:</span> <span class=fu>{</span></span>
<span id=cb11-4><a href=#cb11-4 aria-hidden=true></a>        <span class=dt>&quot;nvidia&quot;</span><span class=fu>:</span> <span class=fu>{</span></span>
<span id=cb11-5><a href=#cb11-5 aria-hidden=true></a>            <span class=dt>&quot;args&quot;</span><span class=fu>:</span> <span class=ot>[]</span><span class=fu>,</span></span>
<span id=cb11-6><a href=#cb11-6 aria-hidden=true></a>            <span class=dt>&quot;path&quot;</span><span class=fu>:</span> <span class=st>&quot;nvidia-container-runtime&quot;</span></span>
<span id=cb11-7><a href=#cb11-7 aria-hidden=true></a>        <span class=fu>}</span></span>
<span id=cb11-8><a href=#cb11-8 aria-hidden=true></a>    <span class=fu>}</span></span>
<span id=cb11-9><a href=#cb11-9 aria-hidden=true></a><span class=fu>}</span></span></code></pre></div><h3 id=测>测</h3><div class=sourceCode id=cb12><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb12-1><a href=#cb12-1 aria-hidden=true></a><span class=co># 拷自 official doc</span></span>
<span id=cb12-2><a href=#cb12-2 aria-hidden=true></a><span class=ex>docker</span> run --rm --runtime=nvidia --gpus all ubuntu nvidia-smi</span></code></pre></div><p><code>--runtime=nvidia</code> 通过这个将显卡传递到 docker 里</p></div><div id=Rsidebar><div id=Avatar><img alt=avatar src=/avatar.jpg></div><ul><li><a href=/about>About Me</a></li><li><a href=/donate>Donate Me</a></li><li><a href=/>Ben's Blog</a></li></ul>除非注明，本博客所有文章皆为原创。<br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div></div><div class=footer><div id=tags><a href=https://bensyz.github.io/blog/tags><i class="fas fa-tags"></i></a>
Keywords:<ul><li><a href=https://bensyz.github.io/blog/tags/NVIDIA>NVIDIA</a></li><li><a href=https://bensyz.github.io/blog/tags/driver>driver</a></li><li><a href=https://bensyz.github.io/blog/tags/docker>docker</a></li></ul></div><footer><hr><a href=/>Ben's Blog</a><br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。<br><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33028102001039"><img alt=public_safety_record src=/icons/public_safety_icon.png>浙公网安备 33028102001039号</a>
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备2021032097号-1</a></footer></div></div></body></html>