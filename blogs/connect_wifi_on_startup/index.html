<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>Linux开机自动连接网络</title><script src=/js/if_mobile.js></script>
<script>!function(){$("pre > code").each(function(){var s,n=$(this).parent().attr("class");n==null||n===""?$(this).addClass("hljs"):(s={js:"javascript"},s[n]&&(n=s[n]),$(this).addClass(n))})}</script><link rel=stylesheet href=/css/hljs/snazzy.css><link rel=stylesheet href=/css/hljs/line-numbers.min.css><script src=/js/hljs/highlight.min.js></script>
<script src=/js/hljs/highlightjs-line-numbers.min.js></script>
<script>hljs.highlightAll()</script><script>hljs.initLineNumbersOnLoad()</script><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/footer.css><link rel=stylesheet href=/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=icon id=light-scheme-icon href=/favicons/favicon_B_Light.ico type=image/x-icon><link rel=icon id=dark-scheme-icon href=/favicons/favicon_B_Dark.ico type=image/x-icon><script src=/js/favicon.js></script></head><body><div class=container><div class=header><h1>Linux开机自动连接网络</h1>Wed, 2020-02-26<hr></div><div class=middle><div id=TitleWithToc><div id=TitleOfToc>Linux开机自动连接网络</div></div><div id=content><p>整合自: https://bbs.archlinux.org/viewtopic.php?id=178625</p><p>上一篇<a href=../connect_wifi_command>文章</a>讲到如何用命令行连接wifi，大家可以去看看。</p><p>本文参考 <a href="https://bbs.archlinux.org/viewtopic.php?id=178625">https://bbs.archlinux.org/viewtopic.php?id=178625</a> ## TL,DR</p><h3 id=wpa_supplicant><code>wpa_supplicant</code></h3><div class=sourceCode id=cb1><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true></a><span class=co># config wpa_supplicant</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true></a><span class=co>#/etc/wpa_supplicant/wpa_supplicant-wlp5s0.conf</span></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true></a></span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true></a><span class=co># enable wpa_supplicant</span></span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true></a><span class=ex>systemctl</span> enable wpa_supplicant@wlp5s0</span></code></pre></div><h3 id=config-systemd-network><code>config systemd-network</code></h3><div class=sourceCode id=cb2><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true></a><span class=co># config systemd-network</span></span>
<span id=cb2-2><a href=#cb2-2 aria-hidden=true></a><span class=co># /etc/systemd/network/00-wireless-dhcp.network</span></span>
<span id=cb2-3><a href=#cb2-3 aria-hidden=true></a>[<span class=ex>Match</span>]</span>
<span id=cb2-4><a href=#cb2-4 aria-hidden=true></a><span class=va>Name=</span>wlp5s0</span>
<span id=cb2-5><a href=#cb2-5 aria-hidden=true></a></span>
<span id=cb2-6><a href=#cb2-6 aria-hidden=true></a>[<span class=ex>Network</span>]</span>
<span id=cb2-7><a href=#cb2-7 aria-hidden=true></a><span class=va>DHCP=</span>yes</span>
<span id=cb2-8><a href=#cb2-8 aria-hidden=true></a></span>
<span id=cb2-9><a href=#cb2-9 aria-hidden=true></a><span class=co># enable systemd-networkd.service</span></span>
<span id=cb2-10><a href=#cb2-10 aria-hidden=true></a><span class=ex>systemctl</span> enable systemd-networkd.service</span></code></pre></div><h2 id=需要工具>需要工具</h2><ol type=1><li><code>wpa_supplicant</code></li><li><code>dhcpcd</code></li></ol><h2 id=配置文件>配置文件</h2><ol type=1><li><p><code>/etc/wpa_supplicant/wpa_supplicant-网卡名.conf</code></p></li><li><p><code>/etc/systemd/network/00-wireless-dhcp.network</code></p></li></ol><h2 id=步骤>步骤</h2><h3 id=wpa_supplicant-1>1. <code>wpa_supplicant</code></h3><h4 id=查看网卡名字>1.1 查看网卡名字</h4><div class=sourceCode id=cb3><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb3-1><a href=#cb3-1 aria-hidden=true></a><span class=ex>ip</span> link</span>
<span id=cb3-2><a href=#cb3-2 aria-hidden=true></a><span class=co># 1: lo</span></span>
<span id=cb3-3><a href=#cb3-3 aria-hidden=true></a><span class=co># 2: enp4s0</span></span>
<span id=cb3-4><a href=#cb3-4 aria-hidden=true></a><span class=co># 3: wlp5s0</span></span></code></pre></div><ol type=1><li>lo 是loop设备</li><li>enp4s0 是有线设备</li><li>wlp5s0 是无线设备</li></ol><p><strong>注意我的网卡名是 <code>wlp5s0</code>，下文中的<code>wlp5s0</code> 都需替换成你的</strong></p><h4 id=生成-wpa_supplicant.conf文件>1.2 生成 <code>wpa_supplicant.conf</code>文件</h4><p>将生成的<code>wpa_supplicant.conf</code> 放到<code>/etc/wpa_supplicant/</code>文件夹下，并重命名，格式为：</p><div class=sourceCode id=cb4><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb4-1><a href=#cb4-1 aria-hidden=true></a><span class=ex>wpa_supplicant-</span>网卡名.conf</span></code></pre></div><p>例如我的就是：</p><div class=sourceCode id=cb5><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb5-1><a href=#cb5-1 aria-hidden=true></a><span class=ex>wpa_supplicant-wlp5s0.conf</span></span></code></pre></div><h5 id=通过修改原始配置文件>通过修改原始配置文件</h5><p><code>man wpa_supplicant.conf</code> 知道原始配置文件在</p><div class=sourceCode id=cb6><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb6-1><a href=#cb6-1 aria-hidden=true></a><span class=ex>/usr/share/doc/wpa_supplicant/wpa_supplicant.conf</span></span></code></pre></div><h5 id=通过wpa_passphrase生成配置文件>通过<code>wpa_passphrase</code>生成配置文件</h5><div class=sourceCode id=cb7><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb7-1><a href=#cb7-1 aria-hidden=true></a><span class=co># wpa_passphrase MyNetwork SuperSecretPassphrase &gt; /etc/wpa_supplicant/wpa_supplicant-wlp5s0.conf</span></span></code></pre></div><h5 id=通过下面的格式>通过下面的格式</h5><p><code>priority</code> 越大优先级越高</p><div class=sourceCode id=cb8><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb8-1><a href=#cb8-1 aria-hidden=true></a><span class=va>country=</span>CN</span>
<span id=cb8-2><a href=#cb8-2 aria-hidden=true></a><span class=va>update_config=</span>1</span>
<span id=cb8-3><a href=#cb8-3 aria-hidden=true></a><span class=va>network=</span><span class=kw>{</span></span>
<span id=cb8-4><a href=#cb8-4 aria-hidden=true></a>    <span class=va>ssid=</span><span class=st>&quot;SSID&quot;</span></span>
<span id=cb8-5><a href=#cb8-5 aria-hidden=true></a>    <span class=va>psk=</span><span class=st>&quot;Passwd&quot;</span></span>
<span id=cb8-6><a href=#cb8-6 aria-hidden=true></a>    <span class=va>key_mgmt=</span>WPA-PSK</span>
<span id=cb8-7><a href=#cb8-7 aria-hidden=true></a>    <span class=va>priority=</span>9</span>
<span id=cb8-8><a href=#cb8-8 aria-hidden=true></a>    <span class=va>id_str=</span><span class=st>&quot;identify which wifi is&quot;</span></span>
<span id=cb8-9><a href=#cb8-9 aria-hidden=true></a><span class=kw>}</span></span>
<span id=cb8-10><a href=#cb8-10 aria-hidden=true></a></span>
<span id=cb8-11><a href=#cb8-11 aria-hidden=true></a><span class=va>network=</span><span class=kw>{</span></span>
<span id=cb8-12><a href=#cb8-12 aria-hidden=true></a>    <span class=va>ssid=</span><span class=st>&quot;SSID&quot;</span></span>
<span id=cb8-13><a href=#cb8-13 aria-hidden=true></a>    <span class=va>psk=</span><span class=st>&quot;Passwd&quot;</span></span>
<span id=cb8-14><a href=#cb8-14 aria-hidden=true></a>    <span class=va>key_mgmt=</span>WPA-PSK</span>
<span id=cb8-15><a href=#cb8-15 aria-hidden=true></a>    <span class=va>priority=</span>8</span>
<span id=cb8-16><a href=#cb8-16 aria-hidden=true></a>    <span class=va>id_str=</span><span class=st>&quot;identify which wifi is&quot;</span></span>
<span id=cb8-17><a href=#cb8-17 aria-hidden=true></a><span class=kw>}</span></span></code></pre></div><h4 id=用systemctl启动wpa_supplicant服务>1.3 用<code>systemctl</code>启动<code>wpa_supplicant</code>服务</h4><div class=sourceCode id=cb9><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb9-1><a href=#cb9-1 aria-hidden=true></a><span class=ex>systemctl</span> enable wpa_supplicant@wlp5s0</span></code></pre></div><p><strong>注意arch bbs 原回答多写了<code>.conf</code></strong>，后面也有跟帖指出了这个问题。</p><h3 id=systemd-networkd>2. <code>systemd-networkd</code></h3><h4 id=配置systemd-network的配置文件>2.1 配置systemd-network的<a href=https://www.centos.bz/2018/05/systemd-%E7%9A%84%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86/>配置文件</a></h4><p>创建<code>/etc/systemd/network/00-wireless-dhcp.network</code>，archbbs中说这个名字随意。</p><pre><code>[Match]
Name=wlp5s0

[Network]
DHCP=yes</code></pre><h4 id=用systemctl设置启动服务systemd-networkd.service>2.2 用<code>systemctl</code>设置启动服务<code>systemd-networkd.service</code></h4><div class=sourceCode id=cb11><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb11-1><a href=#cb11-1 aria-hidden=true></a><span class=ex>systemctl</span> enable systemd-networkd.service</span></code></pre></div><h2 id=回顾>回顾</h2><p>在<a href=#1.3>1.3</a>的<code>systemctl enable wpa_supplicant@wlp5s0</code>中，我们看到：</p><div class=sourceCode id=cb12><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb12-1><a href=#cb12-1 aria-hidden=true></a><span class=ex>Created</span> symlink /etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlp5s0.service → /usr/lib/systemd/system/wpa_supplicant@.service.</span></code></pre></div><p>查看<code>/usr/lib/systemd/system/wpa_supplicant@.service</code>，其中有一行：</p><div class=sourceCode id=cb13><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb13-1><a href=#cb13-1 aria-hidden=true></a><span class=va>ExecStart=</span>/usr/bin/wpa_supplicant <span class=ex>-c/etc/wpa_supplicant/wpa_supplicant-%I.conf</span> -i%I</span></code></pre></div><p>这里的<code>%I</code> 就是<code>systemctl enable wpa_supplicant@wlp5s0</code>中的<code>wlp5s0</code>，它通过<code>%I</code>来传递设备名，所以我们也就知道之前为什么要把配置文件这样命名了</p><div class=sourceCode id=cb14><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb14-1><a href=#cb14-1 aria-hidden=true></a><span class=ex>/etc/wpa_supplicant</span>/<span class=ex>wpa_supplicant-</span>网卡名.conf</span></code></pre></div></div><div id=Rsidebar><div id=Avatar><img alt=avatar src=/avatar.jpg></div><ul><li><a href=/about>About Me</a></li><li><a href=/donate>Donate Me</a></li><li><a href=/>Ben's Blog</a></li></ul>除非注明，本博客所有文章皆为原创。<br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div></div><div class=footer><div id=tags><a href=https://bensyz.github.io/blog/tags><i class="fas fa-tags"></i></a>
Keywords:<ul><li><a href=https://bensyz.github.io/blog/tags/Linux>Linux</a></li><li><a href=https://bensyz.github.io/blog/tags/wifi>wifi</a></li></ul></div><footer><hr><a href=/>Ben's Blog</a><br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。<br><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33028102001039"><img alt=public_safety_record src=/icons/public_safety_icon.png>浙公网安备 33028102001039号</a>
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备2021032097号-1</a></footer></div></div></body></html>