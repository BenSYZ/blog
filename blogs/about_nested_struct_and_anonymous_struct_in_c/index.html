<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>about nested struct and anonymous struct in c</title><script src=/js/if_mobile.js></script>
<script>!function(){$("pre > code").each(function(){var s,n=$(this).parent().attr("class");n==null||n===""?$(this).addClass("hljs"):(s={js:"javascript"},s[n]&&(n=s[n]),$(this).addClass(n))})}</script><link rel=stylesheet href=/css/hljs/snazzy.css><link rel=stylesheet href=/css/hljs/line-numbers.min.css><script src=/js/hljs/highlight.min.js></script>
<script src=/js/hljs/highlightjs-line-numbers.min.js></script>
<script>hljs.highlightAll()</script><script>hljs.initLineNumbersOnLoad()</script><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/footer.css><link rel=stylesheet href=/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=icon id=light-scheme-icon href=/favicons/favicon_B_Light.ico type=image/x-icon><link rel=icon id=dark-scheme-icon href=/favicons/favicon_B_Dark.ico type=image/x-icon><script src=/js/favicon.js></script></head><body><div class=container><div class=header><h1>about nested struct and anonymous struct in c</h1>Sat, 2023-05-20<hr></div><div class=middle><div id=TitleWithToc><div id=TitleOfToc>about nested struct and anonymous struct in c</div></div><div id=content><p>看书的时候没明白一个 macro 的用法，搜了一下，发现这个<a href=https://stackoverflow.com/questions/58346036/c-c-macro-parameter-containing-dot-member-access-operator>问题</a>，发现看不懂他写的结构体的问题。自己尝试写了几个例子发现了 anonymous struct，觉得用法很奇怪，又搜到了这个<a href=https://stackoverflow.com/questions/38457109/c-how-to-access-different-types-of-anonymous-or-unnamed-nested-structs/38457240>问题</a>，一下把我能想到的关于结构体的情况都写出来了</p><div class=sourceCode id=cb1><pre class="sourceCode c"><code class="sourceCode c"><span id=cb1-1><a href=#cb1-1 aria-hidden=true></a><span class=kw>struct</span> s {</span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true></a>    <span class=dt>int</span> abc;</span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true></a></span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true></a>    <span class=kw>struct</span> {</span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true></a>        <span class=dt>int</span> a;</span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true></a>    };</span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true></a></span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true></a>    <span class=kw>struct</span> {</span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true></a>        <span class=dt>int</span> b;</span>
<span id=cb1-10><a href=#cb1-10 aria-hidden=true></a>    } intern;</span>
<span id=cb1-11><a href=#cb1-11 aria-hidden=true></a></span>
<span id=cb1-12><a href=#cb1-12 aria-hidden=true></a>    <span class=kw>struct</span> i {</span>
<span id=cb1-13><a href=#cb1-13 aria-hidden=true></a>        <span class=dt>int</span> c;</span>
<span id=cb1-14><a href=#cb1-14 aria-hidden=true></a>    };</span>
<span id=cb1-15><a href=#cb1-15 aria-hidden=true></a></span>
<span id=cb1-16><a href=#cb1-16 aria-hidden=true></a>    <span class=kw>struct</span> i2 {</span>
<span id=cb1-17><a href=#cb1-17 aria-hidden=true></a>        <span class=dt>int</span> d;</span>
<span id=cb1-18><a href=#cb1-18 aria-hidden=true></a>    } intern2;</span>
<span id=cb1-19><a href=#cb1-19 aria-hidden=true></a></span>
<span id=cb1-20><a href=#cb1-20 aria-hidden=true></a>    <span class=kw>struct</span> i3 {</span>
<span id=cb1-21><a href=#cb1-21 aria-hidden=true></a>        <span class=dt>int</span> e;</span>
<span id=cb1-22><a href=#cb1-22 aria-hidden=true></a>    };</span>
<span id=cb1-23><a href=#cb1-23 aria-hidden=true></a>    <span class=kw>struct</span> i3 intern3;</span>
<span id=cb1-24><a href=#cb1-24 aria-hidden=true></a>};</span>
<span id=cb1-25><a href=#cb1-25 aria-hidden=true></a></span>
<span id=cb1-26><a href=#cb1-26 aria-hidden=true></a><span class=kw>struct</span> i3 AA;</span>
<span id=cb1-27><a href=#cb1-27 aria-hidden=true></a></span>
<span id=cb1-28><a href=#cb1-28 aria-hidden=true></a><span class=dt>int</span> main(<span class=dt>int</span> argc, <span class=dt>char</span> <span class=dt>const</span> *argv[])</span>
<span id=cb1-29><a href=#cb1-29 aria-hidden=true></a>{</span>
<span id=cb1-30><a href=#cb1-30 aria-hidden=true></a>    <span class=kw>struct</span> s mystruct;</span>
<span id=cb1-31><a href=#cb1-31 aria-hidden=true></a></span>
<span id=cb1-32><a href=#cb1-32 aria-hidden=true></a>    mystruct.abc = <span class=dv>0</span>;</span>
<span id=cb1-33><a href=#cb1-33 aria-hidden=true></a>    mystruct.a = <span class=dv>1</span>;</span>
<span id=cb1-34><a href=#cb1-34 aria-hidden=true></a>    mystruct.intern.b = <span class=dv>2</span>;</span>
<span id=cb1-35><a href=#cb1-35 aria-hidden=true></a>    mystruct.c = <span class=dv>3</span>; <span class=co>// &lt;-- does not compile</span></span>
<span id=cb1-36><a href=#cb1-36 aria-hidden=true></a>    mystruct.intern2.d = <span class=dv>4</span>;</span>
<span id=cb1-37><a href=#cb1-37 aria-hidden=true></a>    mystruct.intern3.e = <span class=dv>5</span>;</span>
<span id=cb1-38><a href=#cb1-38 aria-hidden=true></a>    AA.e=<span class=dv>0</span>;</span>
<span id=cb1-39><a href=#cb1-39 aria-hidden=true></a></span>
<span id=cb1-40><a href=#cb1-40 aria-hidden=true></a>    <span class=cf>return</span> <span class=dv>0</span>;</span>
<span id=cb1-41><a href=#cb1-41 aria-hidden=true></a>}</span></code></pre></div><p>两个回答都很好：</p><blockquote><p>Regarding anonymous structure, quoting C11, chapter §6.7.2.1, (emphasis mine)</p><blockquote><p>An unnamed member whose type specifier is a structure specifier with no tag is called an anonymous structure; an unnamed member whose type specifier is a union specifier with no tag is called an anonymous union. The members of an anonymous structure or union are considered to be members of the containing structure or union. This applies recursively if the containing structure or union is also anonymous.</p></blockquote></blockquote><p>说明了 anonymous struct 访问内部变量这种奇怪的 <code>.</code> 法。</p><blockquote><p>Member c is declared inside inside strut i. And you are not creating any variable for struct i</p></blockquote><p>这个回答看起来没说什么，其实说明了 <code>struct i</code> 在 struct 内部的声明（可能不叫声明）等同于放在外面，也解释了 warning 的问题。（其实不等同，不然不会有这个 warning 了）</p><p><a href=./res/example.c>example.c</a></p></div><div id=Rsidebar><div id=Avatar><img alt=avatar src=/avatar.jpg></div><ul><li><a href=/about>About Me</a></li><li><a href=/donate>Donate Me</a></li><li><a href=/>Ben's Blog</a></li></ul>除非注明，本博客所有文章皆为原创。<br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div></div><div class=footer><div id=tags><a href=https://bensyz.github.io/blog/tags><i class="fas fa-tags"></i></a>
Keywords:<ul><li><a href=https://bensyz.github.io/blog/tags/program>program</a></li><li><a href=https://bensyz.github.io/blog/tags/c>c</a></li><li><a href=https://bensyz.github.io/blog/tags/syntax>syntax</a></li></ul></div><footer><hr><a href=/>Ben's Blog</a><br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。<br><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33028102001039"><img alt=public_safety_record src=/icons/public_safety_icon.png>浙公网安备 33028102001039号</a>
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备2021032097号-1</a></footer></div></div></body></html>