<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>python virtual env and venv</title><script src=/js/if_mobile.js></script>
<script>!function(){$("pre > code").each(function(){var s,n=$(this).parent().attr("class");n==null||n===""?$(this).addClass("hljs"):(s={js:"javascript"},s[n]&&(n=s[n]),$(this).addClass(n))})}</script><link rel=stylesheet href=/css/hljs/snazzy.css><link rel=stylesheet href=/css/hljs/line-numbers.min.css><script src=/js/hljs/highlight.min.js></script>
<script src=/js/hljs/highlightjs-line-numbers.min.js></script>
<script>hljs.highlightAll()</script><script>hljs.initLineNumbersOnLoad()</script><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/footer.css><link rel=stylesheet href=/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=icon id=light-scheme-icon href=/favicons/favicon_B_Light.ico type=image/x-icon><link rel=icon id=dark-scheme-icon href=/favicons/favicon_B_Dark.ico type=image/x-icon><script src=/js/favicon.js></script></head><body><div class=container><div class=header><h1>python virtual env and venv</h1>Mon, 2023-06-19<hr></div><div class=middle><div id=TitleWithToc><div id=TitleOfToc>python virtual env and venv</div></div><div id=content><p>pre introduction : stackoverflow <a href=https://stackoverflow.com/a/41573588/13033234>what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe</a></p><p>原先位于 Tips write date: 2021-04-21T00:00:00+08:00</p><h2 id=intro>intro</h2><p><code>anaconda</code> 和 <code>miniconda</code> 是很常用的多版本 python 的管理器，不过我有几点不满意</p><ul><li>过于庞大，不够轻量，即使是 miniconda 好像也有 好几百兆</li><li>而且 conda channel 什么的整了好久都没整明白，</li><li>已经有 pip 了为何还要用 conda install</li></ul><p>当然 conda 还提供了一些非 python 的内容，这是 pip 无法做到的，但是这又和 kiss 原则相违背了。</p><h2 id=softwares>softwares</h2><ol type=1><li><code>pyenv</code>: provide python version</li><li><code>venv</code>: provide virtual environment</li></ol><h2 id=working-flow-example>Working flow example</h2><h3 id=configure>Configure</h3><ol type=1><li>install another version of python</li></ol><p>2023-06-19 update:</p><p>if you want to generate <code>libpython3.so</code></p><div class=sourceCode id=cb1><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb1-1><a href=#cb1-1 aria-hidden=true></a><span class=fu>env</span> CONFIGURE_OPTS=<span class=st>&quot;--enable-shared&quot;</span>  pyenv install 3.10</span></code></pre></div><p>2023-05-26 update:</p><div class=sourceCode id=cb2><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb2-1><a href=#cb2-1 aria-hidden=true></a><span class=ex>pyenv</span> install --patch 3.7.9 <span class=op>&lt;&lt; alignment.patch</span></span></code></pre></div><p><a href=https://github.com/pyenv/pyenv-virtualenv/issues/410>alignment.patch src</a></p><div class=sourceCode id=cb3><pre class="sourceCode diff"><code class="sourceCode diff"><span id=cb3-1><a href=#cb3-1 aria-hidden=true></a><span class=kw>--- Include/objimpl.h</span></span>
<span id=cb3-2><a href=#cb3-2 aria-hidden=true></a><span class=dt>+++ Include/objimpl.h</span></span>
<span id=cb3-3><a href=#cb3-3 aria-hidden=true></a><span class=dt>@@ -250,7 +250,7 @@</span></span>
<span id=cb3-4><a href=#cb3-4 aria-hidden=true></a>         union _gc_head *gc_prev;</span>
<span id=cb3-5><a href=#cb3-5 aria-hidden=true></a>         Py_ssize_t gc_refs;</span>
<span id=cb3-6><a href=#cb3-6 aria-hidden=true></a>     } gc;</span>
<span id=cb3-7><a href=#cb3-7 aria-hidden=true></a><span class=st>-    double dummy;  /* force worst-case alignment */</span></span>
<span id=cb3-8><a href=#cb3-8 aria-hidden=true></a><span class=va>+    long double dummy;  /* force worst-case alignment */</span></span>
<span id=cb3-9><a href=#cb3-9 aria-hidden=true></a> } PyGC_Head;</span>
<span id=cb3-10><a href=#cb3-10 aria-hidden=true></a></span>
<span id=cb3-11><a href=#cb3-11 aria-hidden=true></a> extern PyGC_Head *_PyGC_generation0;</span>
<span id=cb3-12><a href=#cb3-12 aria-hidden=true></a><span class=kw>--- Objects/obmalloc.c</span></span>
<span id=cb3-13><a href=#cb3-13 aria-hidden=true></a><span class=dt>+++ Objects/obmalloc.c</span></span>
<span id=cb3-14><a href=#cb3-14 aria-hidden=true></a><span class=dt>@@ -643,8 +643,8 @@</span></span>
<span id=cb3-15><a href=#cb3-15 aria-hidden=true></a>  *</span>
<span id=cb3-16><a href=#cb3-16 aria-hidden=true></a>  * You shouldn&#39;t change this unless you know what you are doing.</span>
<span id=cb3-17><a href=#cb3-17 aria-hidden=true></a>  */</span>
<span id=cb3-18><a href=#cb3-18 aria-hidden=true></a><span class=st>-#define ALIGNMENT               8               /* must be 2^N */</span></span>
<span id=cb3-19><a href=#cb3-19 aria-hidden=true></a><span class=st>-#define ALIGNMENT_SHIFT         3</span></span>
<span id=cb3-20><a href=#cb3-20 aria-hidden=true></a><span class=va>+#define ALIGNMENT               16               /* must be 2^N */</span></span>
<span id=cb3-21><a href=#cb3-21 aria-hidden=true></a><span class=va>+#define ALIGNMENT_SHIFT         4</span></span>
<span id=cb3-22><a href=#cb3-22 aria-hidden=true></a></span>
<span id=cb3-23><a href=#cb3-23 aria-hidden=true></a> /* Return the number of bytes in size class I, as a uint. */</span>
<span id=cb3-24><a href=#cb3-24 aria-hidden=true></a> #define INDEX2SIZE(I) (((uint)(I) + 1) &lt;&lt; ALIGNMENT_SHIFT)</span></code></pre></div><ol start=2 type=1><li>Add that python to <code>$PATH</code></li></ol><div class=sourceCode id=cb4><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb4-1><a href=#cb4-1 aria-hidden=true></a><span class=co># default python be python 3.7.9</span></span>
<span id=cb4-2><a href=#cb4-2 aria-hidden=true></a><span class=bu>export</span> <span class=va>PYENV_ROOT=</span><span class=st>&quot;</span><span class=va>$HOME</span><span class=st>/.pyenv/versions/3.7.9/&quot;</span></span>
<span id=cb4-3><a href=#cb4-3 aria-hidden=true></a><span class=bu>export</span> <span class=va>PATH=</span><span class=st>&quot;</span><span class=va>$PYENV_ROOT</span><span class=st>/bin:</span><span class=va>$PATH</span><span class=st>&quot;</span></span></code></pre></div><ol start=3 type=1><li>Create virtual environment, there will be python command in <code>.venv/3.6/bin</code>, but it is a link to current <code>python</code>.</li></ol><div class=sourceCode id=cb5><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb5-1><a href=#cb5-1 aria-hidden=true></a><span class=co># create virtual environment</span></span>
<span id=cb5-2><a href=#cb5-2 aria-hidden=true></a><span class=bu>cd</span> ~/.venv</span>
<span id=cb5-3><a href=#cb5-3 aria-hidden=true></a><span class=ex>python</span> -m venv 3.7</span></code></pre></div><ol start=4 type=1><li>Active and deactivate it</li></ol><div class=sourceCode id=cb6><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb6-1><a href=#cb6-1 aria-hidden=true></a><span class=bu>source</span> ~/.venv/3.7/bin/activate</span>
<span id=cb6-2><a href=#cb6-2 aria-hidden=true></a><span class=ex>deactivate</span></span></code></pre></div><p><code>export</code> in the 2nd is no needed this time.</p><h3 id=reuse>Reuse</h3><p>Active and deactivate it</p><div class=sourceCode id=cb7><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb7-1><a href=#cb7-1 aria-hidden=true></a><span class=bu>source</span> ~/.venv/3.6/bin/activate</span>
<span id=cb7-2><a href=#cb7-2 aria-hidden=true></a><span class=ex>deactivate</span></span></code></pre></div><p>you can check if it’s enalbed by:</p><pre><code>which python3
which pip3</code></pre><h3 id=others>others</h3><p>Set pyenv as default, not recommend:</p><div class=sourceCode id=cb9><pre class="sourceCode sh"><code class="sourceCode bash"><span id=cb9-1><a href=#cb9-1 aria-hidden=true></a><span class=co># .zshrc</span></span>
<span id=cb9-2><a href=#cb9-2 aria-hidden=true></a><span class=co># pyenv</span></span>
<span id=cb9-3><a href=#cb9-3 aria-hidden=true></a><span class=bu>export</span> <span class=va>PYENV_ROOT=</span><span class=st>&quot;</span><span class=va>$HOME</span><span class=st>/.pyenv&quot;</span></span>
<span id=cb9-4><a href=#cb9-4 aria-hidden=true></a><span class=bu>export</span> <span class=va>PATH=</span><span class=st>&quot;</span><span class=va>$PYENV_ROOT</span><span class=st>/bin:</span><span class=va>$PATH</span><span class=st>&quot;</span></span>
<span id=cb9-5><a href=#cb9-5 aria-hidden=true></a><span class=kw>if</span> <span class=bu>command</span> -v pyenv <span class=op>1&gt;</span>/dev/null <span class=op>2&gt;&amp;1</span><span class=kw>;</span> <span class=kw>then</span></span>
<span id=cb9-6><a href=#cb9-6 aria-hidden=true></a>  <span class=bu>eval</span> <span class=st>&quot;</span><span class=va>$(</span><span class=ex>pyenv</span> init -<span class=va>)</span><span class=st>&quot;</span></span>
<span id=cb9-7><a href=#cb9-7 aria-hidden=true></a><span class=kw>fi</span></span></code></pre></div></div><div id=Rsidebar><div id=Avatar><img alt=avatar src=/avatar.jpg></div><ul><li><a href=/about>About Me</a></li><li><a href=/donate>Donate Me</a></li><li><a href=/>Ben's Blog</a></li></ul>除非注明，本博客所有文章皆为原创。<br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div></div><div class=footer><div id=tags><a href=https://bensyz.github.io/blog/tags><i class="fas fa-tags"></i></a>
Keywords:<ul><li><a href=https://bensyz.github.io/blog/tags/python>python</a></li><li><a href=https://bensyz.github.io/blog/tags/conda>conda</a></li></ul></div><footer><hr><a href=/>Ben's Blog</a><br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。<br><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33028102001039"><img alt=public_safety_record src=/icons/public_safety_icon.png>浙公网安备 33028102001039号</a>
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备2021032097号-1</a></footer></div></div></body></html>