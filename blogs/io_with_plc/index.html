<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>io_with_plc</title><script src=/js/if_mobile.js></script>
<script>!function(){$("pre > code").each(function(){var s,n=$(this).parent().attr("class");n==null||n===""?$(this).addClass("hljs"):(s={js:"javascript"},s[n]&&(n=s[n]),$(this).addClass(n))})}</script><link rel=stylesheet href=/css/hljs/snazzy.css><link rel=stylesheet href=/css/hljs/line-numbers.min.css><script src=/js/hljs/highlight.min.js></script>
<script src=/js/hljs/highlightjs-line-numbers.min.js></script>
<script>hljs.highlightAll()</script><script>hljs.initLineNumbersOnLoad()</script><link rel=stylesheet href=/css/code.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/footer.css><link rel=stylesheet href=/css/font-awesome.min.css integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin=anonymous><link rel=icon id=light-scheme-icon href=/favicons/favicon_B_Light.ico type=image/x-icon><link rel=icon id=dark-scheme-icon href=/favicons/favicon_B_Dark.ico type=image/x-icon><script src=/js/favicon.js></script>
<link rel=stylesheet href=/css/katex.min.css integrity=sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET crossorigin=anonymous><script defer src=/js/katex.min.js integrity=sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb crossorigin=anonymous></script>
<script defer src=/js/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})'></script></head><body><div class=container><div class=header><h1>io_with_plc</h1>Tue, 2023-07-11<br>本文最后修改于 Thu, 2023-08-17<hr></div><div class=middle><div id=TitleWithToc><div id=TitleOfToc>io_with_plc</div></div><div id=content><p>2023-08-17 update: summary 中添加开关状态</p><h1 id=intro>Intro</h1><p>在阅读之前有一点需要注意的是，我们的输出、输入，和 PLC 的输出、输入不一样，PLC 的输出和输入是带着电源的，我们的不带电源。这点对输入很好理解，但是对于输出，不能理解成我们输出电压，我们的输出只是一个开关。</p><h2 id=input>Input</h2><figure><img src=./figures/input.png alt><figcaption>input</figcaption></figure><h3 id=一些标记>一些标记</h3><ul><li>左侧<ul><li><code>OP_IN0</code>：外部看到的 <code>IN0</code></li><li><code>COMIN1</code>：外部看到的 IN 口的 <code>COM</code> 口</li></ul></li><li>右侧<ul><li>⏚ ：地 GND</li><li><code>GPIO1_C0_Z</code>：连到上级芯片（主芯片）。</li></ul></li><li>中间<ul><li><code>PS2805</code>：光耦，如果 <code>1</code> <code>2</code> 引脚间有电压差，就会发光，会激发 <code>3</code> <code>4</code> 引脚间的光敏二极管，即 <code>3</code> <code>4</code> 导通，也就是 <strong>有电压差，开关闭合</strong></li></ul><img src=./figures/PS2805.png title=fig: alt=PS2805></li></ul><h3 id=右内侧电路>右（内）侧电路</h3><p>先说简单的：</p><ul><li>工作状态：<code>3</code> <code>4</code> 引脚间的光敏二极管导通，<code>GPIO1_C0_Z</code> 的电压等于 3 引脚的 <code>GND</code>，低电平</li><li>停止工作状态：<code>3</code> <code>4</code> 引脚间的光敏二极管开路断开，<code>GPIO1_C0_Z</code> 的电压等于 <code>VCC_1V8_S0</code>，高电平</li></ul><h3 id=左外侧电路>左（外）侧电路</h3><ul><li><code>COMIN1</code> 高电平<ul><li><code>OP_IN0</code> 低电平，<code>1</code> <code>2</code> 之间<strong>有</strong>电压差，中间的光耦工作。</li><li><code>OP_IN0</code> 高电平，<code>1</code> <code>2</code> 之间<strong>无</strong>电压差，中间的光耦不工作。</li></ul></li><li><code>COMIN1</code> 低电平，<code>OP_IN0=1</code>，<code>1</code> <code>2</code> 之间有电压差，中间的光耦工作<ul><li><code>OP_IN0</code> 低电平，<code>1</code> <code>2</code> 之间<strong>无</strong>电压差，中间的光耦不工作。</li><li><code>OP_IN0</code> 高电平，<code>1</code> <code>2</code> 之间<strong>有</strong>电压差，中间的光耦工作。</li></ul></li></ul><h3 id=整体电路>整体电路</h3><p>定义：</p><ul><li><code>COMIN1</code> 为 <code>COM</code></li><li><code>OP_IN0</code> 为 <code>IN</code></li><li><code>GPIO1_C0_Z</code> 为 <code>GPIO</code></li><li>高电平为 1， 低电平为 0</li></ul><p>那么：</p><table><thead><tr class=header><th></th><th><code>IN = 1</code></th><th><code>IN = 0</code></th></tr></thead><tbody><tr class=odd><td><code>COM = 1</code></td><td><code>GPIO = 1</code></td><td><code>GPIO = 0</code></td></tr><tr class=even><td><code>COM = 0</code></td><td><code>GPIO = 0</code></td><td><code>GPIO = 1</code></td></tr></tbody></table><p><span class="math inline">\(\text{GPIO} = \text{IN} \odot \text{COM}\)</span> 同或关系（相同为1）</p><p>上升沿和下降沿看的是 <code>IN</code>，所以：</p><ul><li>如果 <code>COM</code> 口 是高电平，<span class="math inline">\(\text{GPIO} = \text{IN}\)</span></li><li>如果 <code>COM</code> 口 是低电平，<span class="math inline">\(\text{GPIO} = \overline{\text{IN}}\)</span>，那么实际的上升沿和输入到系统的上升沿是反的</li></ul><hr><ul><li><code>COM</code> 口 高电平对应的 <code>PLC</code> 类型是 <code>NPN</code></li><li><code>COM</code> 口 低电平对应的 <code>PLC</code> 类型是 <code>PNP</code></li></ul><table><thead><tr class=header><th></th><th><code>IN = 1</code></th><th><code>IN = 0</code></th><th>to soc</th></tr></thead><tbody><tr class=odd><td><code>NPN</code> <code>COM = 1</code></td><td><code>GPIO = 1</code></td><td><code>GPIO = 0</code></td><td>No reverse</td></tr><tr class=even><td><code>PNP</code> <code>COM = 0</code></td><td><code>GPIO = 0</code></td><td><code>GPIO = 1</code></td><td>Reverse</td></tr></tbody></table><h3 id=with-plc-side>With PLC side</h3><p>为了理解输出我们需要看完整的电路情况</p><h4 id=simple-view>Simple View</h4><table><thead><tr class=header><th><code>COM = 1</code></th><th><code>COM = 0</code></th></tr></thead><tbody><tr class=odd><td><img src=./figures/input_com_p.png width=500 alt=input_com_p></td><td><img src=./figures/input_com_n.png width=500 alt=input_com_n></td></tr></tbody></table><p>值：</p><table><thead><tr class=header><th></th><th><code>IN = 1</code> （PLC 开关断开）</th><th><code>IN = 0</code> （PLC 开关闭合）</th><th>to soc</th></tr></thead><tbody><tr class=odd><td><code>NPN</code> <code>COM = 1</code></td><td><code>GPIO = 1</code></td><td><code>GPIO = 0</code></td><td>No reverse</td></tr><tr class=even><td><code>PNP</code> <code>COM = 0</code></td><td><code>GPIO = 0</code></td><td><code>GPIO = 1</code></td><td>Reverse</td></tr></tbody></table><p>延触发：</p><p><code>NPN</code>， <code>COM=1</code></p><table><thead><tr class=header><th>开关状态</th><th><code>IN</code></th><th>外部的沿</th><th>光耦间电压差</th><th><code>GPIO</code></th><th>to soc</th></tr></thead><tbody><tr class=odd><td><code>断开->闭合</code></td><td><code>1->0</code></td><td><code>下降沿</code></td><td>无->有</td><td><code>1->0</code></td><td><code>下降沿</code></td></tr><tr class=even><td><code>闭合->断开</code></td><td><code>0->1</code></td><td><code>上升沿</code></td><td>有->无</td><td><code>0->1</code></td><td><code>上升沿</code></td></tr></tbody></table><p><code>PNP</code>，<code>COM=0</code></p><table><thead><tr class=header><th>开关状态</th><th><code>IN</code></th><th>外部的沿</th><th>光耦间电压差</th><th><code>GPIO</code></th><th>to soc</th></tr></thead><tbody><tr class=odd><td><code>断开->闭合</code></td><td><code>0->1</code></td><td><code>上升沿</code></td><td>无->有</td><td><code>1->0</code></td><td><code>下降沿</code></td></tr><tr class=even><td><code>闭合->断开</code></td><td><code>1->0</code></td><td><code>下降沿</code></td><td>有->无</td><td><code>0->1</code></td><td><code>上升沿</code></td></tr></tbody></table><h4 id=full-view>Full View</h4><p>相对更完整的视图</p><table><thead><tr class=header><th><code>COM = 1</code>, <code>NPN</code></th><th><code>COM = 0</code>, <code>PNP</code></th></tr></thead><tbody><tr class=odd><td><img src=./figures/input_with_npn_plc.png width=500 alt=input_with_npn_plc></td><td><img src=./figures/input_with_pnp_plc.png width=500 alt=input_with_pnp_plc></td></tr></tbody></table><h2 id=输出端>输出端：</h2><figure><img src=./figures/output.png alt><figcaption>output</figcaption></figure><h3 id=一些标记-1>一些标记</h3><ul><li>右（外）侧<ul><li><code>OP_OUT0</code>：外部看到的 <code>OUT0</code></li><li><code>COMOUT0</code>：外部看到的 OUT 口的 <code>COM</code> 口</li><li><code>BCX55</code>：NPN 三极管</li></ul></li><li>左（内）侧<ul><li><code>RJ45_3V3</code>：3.3V</li><li><code>OUT0_V</code>：连到上级芯片（主芯片），被控制的引脚。</li></ul></li><li>中间<ul><li><code>PS2805</code> 同 INPUT</li></ul></li></ul><h3 id=左内侧电路>左（内）侧电路</h3><ul><li><code>OUT0_V</code> 低电平，<code>1</code> <code>2</code> 之间<strong>有</strong>电压差，中间的光耦工作。</li><li><code>OUT0_V</code> 高电平，<code>1</code> <code>2</code> 之间<strong>无</strong>电压差，中间的光耦不工作。</li></ul><h3 id=右外侧电路>右（外）侧电路</h3><p>如开始所说，我们的输出的外侧需要接外部电源。由于中间的三极管是 <code>NPN</code>，<code>e</code>极需接低电平，<code>c</code>极需接高电平，所以，<code>COMOUT0</code> 需要连低电平，<code>OP_OUT0 = 1</code> 需要连接高电平。</p><ul><li>停止工作状态：<code>3</code> <code>4</code> 引脚间的光敏二极管开路断开，三极管<code>NPN</code> 的 <code>b</code> 极电平等于<code>COMOUT0=0</code>，三极管截止，<code>OP_OUT0</code> 电压等于外部电压也就是 <code>0</code></li><li>工作状态：<code>3</code> <code>4</code> 引脚间的光敏二极管导通，三极管<code>NPN</code> 的 <code>b</code> 极电平等于<code>OP_OUT0=1</code>，三极管导通，<code>OP_OUT0</code> 的电压等于 <code>COMOUT0 + 三极管分压 ~0</code>（有个问题：为什么不是 <code>COMOUT0</code> 的电压等于 <code>OP_OUT0</code> 的电压？这个问题需要考虑负载，但是通常，<code>COM</code> 口会直连电源的正负极，负载会在 <code>OP_OUT0</code> 和电源之间，所以这里是 <code>OP_OUT0</code> 电平被拉到和 <code>COMOUT0</code> 一致。有点绕，因为这里没有地）</li></ul><table><thead><tr class=header><th><code>3</code> <code>4</code> 光敏二极管</th><th><code>NPN</code> 的 <code>b</code> 极电压</th><th>三极管状态</th><th><code>OP_OUT0</code> 电压</th></tr></thead><tbody><tr class=odd><td>断开</td><td>等于<code>COMOUT0=0</code></td><td>截止</td><td>初始电压 <code>0</code></td></tr><tr class=even><td>导通</td><td>等于<code>OP_OUT0</code> <code>=1</code>然后略大于 <code>0</code></td><td>导通</td><td>拉低 <code>~0+</code>(三极管分压)</td></tr></tbody></table><h3 id=整体电路-1>整体电路</h3><p>定义：</p><ul><li><code>COMOUT0</code> 为 <code>COM</code></li><li><code>OP_OUT0</code> 为 <code>OUT</code></li><li><code>OUT0_V</code> 为 <code>GPIO</code></li><li>高电平为 1， 低电平为 0</li></ul><p>那么：</p><table><thead><tr class=header><th></th><th><code>COM = 0</code></th></tr></thead><tbody><tr class=odd><td><code>GPIO = 1</code></td><td><code>OUT = 1</code></td></tr><tr class=even><td><code>GPIO = 0</code></td><td><code>OUT = 0</code></td></tr></tbody></table><h3 id=with-plc-side-1>With PLC side</h3><figure><img src=./figures/output_with_plc.png width=500 alt><figcaption>output_wit_plc</figcaption></figure><p><code>COM=0</code></p><table><thead><tr class=header><th><code>GPIO</code> 写</th><th>光耦间电压差</th><th>开关状态</th><th><code>OUT</code></th><th>外部的沿</th></tr></thead><tbody><tr class=odd><td><code>1->0</code></td><td>无->有</td><td><code>断开->闭合</code></td><td><code>1->0</code></td><td><code>下降沿</code></td></tr><tr class=even><td><code>0->1</code></td><td>有->无</td><td><code>闭合->断开</code></td><td><code>1->0</code></td><td><code>上升沿</code></td></tr></tbody></table><h2 id=others>Others</h2><p>最开始说的我们的输出和输入是不带源的，那么如果想让我们的 Output 输出到 Input，需要做的就是外加一个电源。</p><figure><img src=./figures/output_to_input.png width=500 alt><figcaption>output_to_input</figcaption></figure><h2 id=summary>Summary</h2><p>由于很多机构只关注自己的开关型号和是否有输出（即上文所述的开关的状态）。而我们的软件给的是电平，所以这里也给出相应的结论：</p><h3 id=input-1>Input</h3><p>外部 PLC <code>NPN</code> （<code>COM=1</code>）</p><table><thead><tr class=header><th>开关状态</th><th>外部的沿</th><th>to soc</th></tr></thead><tbody><tr class=odd><td>按下</td><td><code>下降沿</code></td><td><code>下降沿</code></td></tr><tr class=even><td>松开</td><td><code>上升沿</code></td><td><code>上升沿</code></td></tr></tbody></table><p>外部 PLC <code>PNP</code> （<code>COM=0</code>）</p><table><thead><tr class=header><th>开关状态</th><th>外部的沿</th><th>to soc</th></tr></thead><tbody><tr class=odd><td>按下</td><td><code>上升沿</code></td><td><code>下降沿</code></td></tr><tr class=even><td>松开</td><td><code>下降沿</code></td><td><code>上升沿</code></td></tr></tbody></table><h3 id=output>Output</h3><table><thead><tr class=header><th><code>GPIO</code> 写</th><th>“开关状态”</th><th>外部的电平</th></tr></thead><tbody><tr class=odd><td><code>0</code></td><td>按下(有输出)</td><td><code>0</code></td></tr><tr class=even><td><code>1</code></td><td>松开(无输出)</td><td><code>1</code></td></tr></tbody></table><ul><li>当然我们自己的板子是没有所谓的开关状态的，就是方便和外部对状态。</li><li>Kenexs 软件中的输出高低电平是和外部的电平统一的</li></ul></div><div id=Rsidebar><div id=Avatar><img alt=avatar src=/avatar.jpg></div><ul><li><a href=/about>About Me</a></li><li><a href=/donate>Donate Me</a></li><li><a href=/>Ben's Blog</a></li></ul>除非注明，本博客所有文章皆为原创。<br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div></div><div class=footer><div id=tags><a href=https://bensyz.github.io/blog/tags><i class="fas fa-tags"></i></a>
Keywords:<ul><li><a href=https://bensyz.github.io/blog/tags/io_with_plc>io_with_plc</a></li><li><a href=https://bensyz.github.io/blog/tags/kenexs>kenexs</a></li></ul></div><footer><hr><a href=/>Ben's Blog</a><br>本作品采用<a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。<br><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33028102001039"><img alt=public_safety_record src=/icons/public_safety_icon.png>浙公网安备 33028102001039号</a>
<a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备2021032097号-1</a></footer></div></div></body></html>