<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>arch-chroot on Ben's Blog</title><link>https://bensyz.github.io/blog/tags/arch-chroot/</link><description>Recent content in arch-chroot on Ben's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 30 Sep 2021 19:13:30 +0800</lastBuildDate><atom:link href="https://bensyz.github.io/blog/tags/arch-chroot/index.xml" rel="self" type="application/rss+xml"/><item><title>å°†æœåŠ¡å™¨çš„ Ubuntu ç³»ç»Ÿæ¢æˆ Arch Linux</title><link>https://bensyz.github.io/blog/blogs/vps2arch/</link><pubDate>Thu, 30 Sep 2021 19:13:30 +0800</pubDate><guid>https://bensyz.github.io/blog/blogs/vps2arch/</guid><description>&lt;h2 id="introduction">Introduction&lt;/h2>
&lt;p>è¿™ä¸¤å¤©è…¾è®¯åœ¨ææ´»åŠ¨ï¼Œæœ‰ä¾¿å®œçš„æœåŠ¡å™¨ï¼Œäºæ˜¯ä¹°äº†ï¼Œå¦‚ä¹‹å‰çš„é˜¿é‡Œäº‘ä¸€æ ·æ²¡æœ‰ Arch Linux çš„ç³»ç»Ÿé•œåƒã€‚&lt;/p>
&lt;p>æ—©å°±å¬è¯´äº†æœ‰ä¸€ä¸ªå« &lt;code>vps2arch&lt;/code> çš„è„šæœ¬å¯ä»¥å°†æœåŠ¡å™¨ä¸Šçš„ Ubuntu ç³»ç»Ÿè½¬æˆå…¶ä»–ç³»ç»Ÿï¼Œç„¶åçœ‹ &lt;a href="https://wiki.archlinux.org/title/Install_Arch_Linux_from_existing_Linuxï¼ˆç®€ä½“ä¸­æ–‡ï¼‰#ä»ä¸€ä¸ªä¸»æœºè¿è¡Œå¦ä¸€ä¸ª%20Linux%20å‘è¡Œç‰ˆ">Arch wiki&lt;/a> çš„æ—¶å€™å‘ç°äº†ä¸æ­¢å®ƒï¼Œè¿˜æœ‰å¥½å¤šï¼Œå®ƒè¿˜ä»‹ç»äº†å¦‚ä½•æ‰‹åŠ¨è½¬åˆ° Arch Linuxã€‚ç© Arch çš„äººæ€ä¹ˆèƒ½ä¸æ‰‹åŠ¨è¯•è¯•å‘¢ğŸ¤ªï¼ˆå‘ç°è¿™ä¸ªè„šæœ¬æ˜¯åœ¨åŸæ¥é˜¿é‡Œäº‘è¿‡æœŸä¹‹åçš„äº‹äº†ã€‚ç„¶åä¸€ç›´æ²¡æœºä¼šï¼Œè™½ç„¶è™šæ‹Ÿæœºä¸Šä¹Ÿè¡Œï¼Œä½†æ‡’å•Š)&lt;/p>
&lt;p>ç„¶è€Œ Arch wiki åœ¨åé¢&lt;a href="https://wiki.archlinux.org/title/Install_Arch_Linux_from_existing_Linuxï¼ˆç®€ä½“ä¸­æ–‡ï¼‰#å®‰è£…æç¤º">å®‰è£…æç¤º&lt;/a> é‚£èŠ‚è®©æˆ‘ä» &lt;a href="https://wiki.archlinux.org/title/Installation_guide_ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰">Installation Guide&lt;/a> ä¸­çš„é‡æ–°åˆ†åŒºå¼€å§‹ï¼Œç»§ç»­åé¢çš„æ“ä½œï¼Œæˆ‘å°±è¿™æ ·è¯•äº†ï¼Œç„¶åâ€¦.ğŸ¤¦ç³»ç»ŸæŒ‚äº†ã€‚é‚£ä¸ªæ—¶å€™ä¹Ÿæ²¡æ‡‚åŸç†ï¼Œä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯æ˜¯å¦èƒ½å¤ŸæŠŠç³»ç»Ÿå…¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åå°±å¯ä»¥æŠŠåŸåˆ†åŒºåˆ äº†é‡æ–°åˆ†åŒºï¼Œç„¶ååˆçœ‹åˆ° wiki æ˜¯è¿™æ ·è¯´çš„ï¼Œå°±å°½ä¿¡äº†ã€‚&lt;/p>
&lt;p>åæ¥æˆ‘æ‰¾åˆ°äº†è¿™ç¯‡&lt;a href="https://blog.inkuang.com/2020/114/">åšå®¢&lt;/a>ï¼Œç„¶åå°±æˆå•¦ï¼ŒåŸæ¥åé¢çš„æ­¥éª¤æ˜¯â€œæŒ‚è½½åˆ†åŒºâ€è€Œä¸æ˜¯â€å»ºç«‹åˆ†åŒºâ€œã€‚&lt;/p>
&lt;p>å†™åšå®¢çš„æ—¶å€™æ‰å‘ç°ï¼ŒåŸæ¥ä¸­æ–‡æ‰‹å†Œé‡Œè¯´çš„å°±æ˜¯â€œæŒ‚è½½â€ï¼Œè€Œè‹±æ–‡æ‰‹å†Œé‡Œæ˜¯â€œåˆ†åŒºâ€ ğŸ˜  ï¼Œå½“ç„¶ç°åœ¨æˆ‘æŠŠå®ƒæ”¹å¥½å•¦ğŸ˜&lt;/p>
&lt;h2 id="åŸç†">åŸç†&lt;/h2>
&lt;p>é€šè¿‡ &lt;code>chroot&lt;/code> è¿›å…¥ Arch Linux ç³»ç»Ÿï¼Œåˆ é™¤åŸ Ubuntu ç³»ç»Ÿæ–‡ä»¶ï¼Œæ­¤æ—¶åŸæ¥ç³»ç»Ÿçš„å†…æ ¸è¿˜åœ¨å†…å­˜ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ Arch Linux ç³»ç»Ÿå‘è¿™ä¸ªå†…æ ¸å‘é€æŒ‡ä»¤ã€‚ &lt;em>å†…æ ¸&lt;/em> å’Œ &lt;em>æ“ä½œç³»ç»Ÿ&lt;/em> çš„å…³ç³»å¯ä»¥çœ‹çœ‹æˆ‘çš„è¿™ç¯‡å…³äº &lt;a href="https://bensyz.github.io/blog/blogs/gpio/">gpio&lt;/a> çš„æ–‡ç« ã€‚&lt;/p>
&lt;p>åœ¨è¿™é‡Œæ“ä½œç³»ç»Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºä½ èƒ½çœ‹åˆ°çš„å„ç§æ–‡ä»¶ï¼Œé™¤äº†å†…æ ¸æŠŠä¸€äº›å†…æ ¸ç©ºé—´çš„æ–‡ä»¶æ˜ å°„åˆ°æ–‡ä»¶ç³»ç»Ÿå†…çš„æ–‡ä»¶ï¼Œæ¯”æ–¹è¯´ &lt;code>/proc&lt;/code> &lt;code>/sys&lt;/code> &lt;code>/run&lt;/code> ä¸‹çš„å„ç§æ–‡ä»¶ç­‰ç­‰ï¼Œè¿˜æœ‰è®¾å¤‡æ–‡ä»¶å¤¹ &lt;code>/dev&lt;/code> ä¸‹çš„å†…å®¹ä¹Ÿåº”è¯¥æ˜¯å†…æ ¸ç”Ÿæˆå‡ºæ¥çš„ã€‚æˆ‘ä»¬é€šè¿‡ Arch linux ç³»ç»Ÿå‘åŸå†…æ ¸å‘é€å‘½ä»¤æ˜¯æ€ä¹ˆå‘é€çš„ï¼Œä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>ls&lt;/code> æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œé‚£è¿™ä¸ªå‘½ä»¤å¯¹åº”çš„æ˜¯è¿™ä¸ªå‘½ä»¤æ–‡ä»¶æœ¬èº« &lt;code>/bin/ls&lt;/code> å’Œå®ƒæ‰€ä¾èµ–çš„å„ç§åº“ ï¼ˆé€šè¿‡ &lt;code>ldd /bin/ls&lt;/code> å¯ä»¥æŸ¥çœ‹ï¼‰è¿™é‡Œçš„åº“ç±»ä¼¼äº python çš„åŒ…ã€‚ç°åœ¨æˆ‘ä»¬æœ‰ Arch è¿™ä¸ªå®Œæ•´çš„ chroot çš„ç³»ç»Ÿï¼Œé‚£å½“ç„¶å¯ä»¥å‘å†…æ ¸å‘é€å‘½ä»¤å•¦ã€‚&lt;/p>
&lt;h2 id="å®éªŒ">å®éªŒ&lt;/h2>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong>: è®°å¾—å¯¹å½“å‰ç³»ç»Ÿåˆ›å»ºå¿«ç…§ï¼Œå› ä¸ºæœ‰å¯èƒ½ç½‘ä¸å¥½ï¼Œè€Œä½ åˆè¿˜æ²¡é…ç½®å¥½ç³»ç»Ÿï¼Œé‚£å°±æ²¡äº†â€¦.&lt;/p>
&lt;p>æŒ‰ç…§ Arch wiki &lt;a href="https://wiki.archlinux.org/title/Install_Arch_Linux_from_existing_Linux_ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰">Install Arch Linux from existing Linux&lt;/a>&lt;/p>
&lt;h3 id="å»è¿™é‡Œ-æŒ‘ä¸ªé•œåƒç½‘ç«™ä¸‹-bootstrap-çš„-tar-åŒ…æ”¾åˆ°-tmp-è§£å‹">1. å»&lt;a href="https://archlinux.org/download/">è¿™é‡Œ&lt;/a> æŒ‘ä¸ªé•œåƒç½‘ç«™ï¼Œä¸‹ bootstrap çš„ tar åŒ…ï¼Œæ”¾åˆ° &lt;code>/tmp&lt;/code> ï¼Œè§£å‹ï¼š&lt;/h3>
&lt;pre class="shell">&lt;code># tar xzf /tmp/archlinux-bootstrap-...-x86_64.tar.gz&lt;/code>&lt;/pre>
&lt;h3 id="ç¼–è¾‘-mirrorlist">2. ç¼–è¾‘ &lt;code>mirrorlist&lt;/code>&lt;/h3>
&lt;p>ç”±äº bootstrap ä¸­æ²¡æœ‰ç¼–è¾‘å™¨ï¼Œä½ éœ€è¦å…ˆç¼–è¾‘ &lt;code>mirrorlist&lt;/code> ï¼Œé€‰ä¸€ä¸ªé•œåƒç½‘ç«™&lt;/p>
&lt;pre class="shell">&lt;code># vim /tmp/root.x86_64/etc/pacman.d/mirrorlist&lt;/code>&lt;/pre>
&lt;p>å¦‚æœå¿˜è®°äº†ï¼Œç„¶å Ubuntu ç³»ç»Ÿåˆåˆ äº†ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>sed&lt;/code> æˆ–è€…&lt;code>echo &amp;gt;&amp;gt;&lt;/code>&lt;/p>
&lt;pre class="shell">&lt;code># sed -i &amp;#39;s/#\(.*ustc.*\)/\1/p&amp;#39; /etc/pacman.d/mirrorlist&lt;/code>&lt;/pre>
&lt;h3 id="chroot">3. &lt;code>chroot&lt;/code>&lt;/h3>
&lt;p>å°†è¿™ä¸ªç›®å½•ç»‘åˆ°è¿™ä¸ªç›®å½•ï¼Œå¤§æ¦‚ç‡æ˜¯è¦è¿™æ¡ &lt;code>mount&lt;/code> çš„ï¼Œåº”è¯¥æ˜¯æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ª mount pointï¼Œè¿™æ ·åœ¨ &lt;code>chroot&lt;/code> çš„æ—¶å€™ä¸ä¼šæœ‰è­¦å‘Šã€‚å¹¶ &lt;code>chroot&lt;/code>&lt;/p>
&lt;pre class="shell">&lt;code># mount --bind /tmp/root.x86_64 /tmp/root.x86_64&lt;/code>&lt;/pre>
&lt;pre class="shell">&lt;code># /tmp/root.x86_64/bin/arch-chroot /tmp/root.x86_64/&lt;/code>&lt;/pre>
&lt;p>&lt;code>arch-chroot&lt;/code> ç›¸å¯¹äº &lt;code>chroot&lt;/code> çš„åŒºåˆ«åœ¨äºï¼Œå®ƒæŠŠä¸€äº›å†…æ ¸ç©ºé—´çš„ç›®å½•æŒ‚è½½åˆ°äº† &lt;code>chroot&lt;/code> ç¯å¢ƒä¸­ï¼Œå¯ä»¥çœ‹ Arch wiki çš„ &lt;a href="https://wiki.archlinux.org/title/Install_Arch_Linux_from_existing_Linux_ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰#å®‰è£…æç¤º">æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Bootstrap é•œåƒ&lt;/a>èŠ‚&lt;/p>
&lt;h3 id="åˆå§‹åŒ–-pacman-å¯†é’¥">4. åˆå§‹åŒ– &lt;code>pacman&lt;/code> å¯†é’¥&lt;/h3>
&lt;pre class="shell">&lt;code># pacman-key --init
# pacman-key --populate archlinux&lt;/code>&lt;/pre>
&lt;h3 id="æŠŠåˆ†åŒºå†æŒ‚åˆ°-chroot-çš„-mnt-ä¸‹">5. æŠŠåˆ†åŒºå†æŒ‚åˆ° &lt;code>chroot&lt;/code> çš„ &lt;code>/mnt&lt;/code> ä¸‹&lt;/h3>
&lt;p>æˆ‘ä»¬è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹ä¸€ä¸‹åˆ†åŒºè¡¨ï¼š&lt;/p>
&lt;div class="sourceCode" id="cb7">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb7-1">&lt;a href="#cb7-1" aria-hidden="true">&lt;/a>$ &lt;span class="ex">lsblk&lt;/span>&lt;/span>
&lt;span id="cb7-2">&lt;a href="#cb7-2" aria-hidden="true">&lt;/a>&lt;span class="ex">NAME&lt;/span> MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS&lt;/span>
&lt;span id="cb7-3">&lt;a href="#cb7-3" aria-hidden="true">&lt;/a>&lt;span class="ex">sr0&lt;/span> 11:0 1 145.7M 0 rom&lt;/span>
&lt;span id="cb7-4">&lt;a href="#cb7-4" aria-hidden="true">&lt;/a>&lt;span class="ex">vda&lt;/span> 254:0 0 80G 0 disk&lt;/span>
&lt;span id="cb7-5">&lt;a href="#cb7-5" aria-hidden="true">&lt;/a>&lt;span class="kw">|&lt;/span>&lt;span class="ex">-vda1&lt;/span> 254:1 0 1M 0 part&lt;/span>
&lt;span id="cb7-6">&lt;a href="#cb7-6" aria-hidden="true">&lt;/a>â””&lt;span class="ex">-vda2&lt;/span> 254:2 0 80G 0 part /etc/resolv.conf&lt;/span>
&lt;span id="cb7-7">&lt;a href="#cb7-7" aria-hidden="true">&lt;/a> &lt;span class="ex">/mnt&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>&lt;code>/etc/resolve.conf&lt;/code> æ˜¯ &lt;code>arch-chroot&lt;/code> å¯¼è‡´çš„ï¼Œè¿™é‡Œçš„ &lt;code>/mnt&lt;/code> å°±æ˜¯ Installation guide ä¸­çš„ &lt;code>/mnt&lt;/code> äº†ã€‚&lt;/p>
&lt;h3 id="åˆ -ubuntu-çš„ç³»ç»Ÿæ–‡ä»¶">6. åˆ  Ubuntu çš„ç³»ç»Ÿæ–‡ä»¶&lt;/h3>
&lt;p>ç°åœ¨å¯ä»¥åˆ é™¤ Ubuntu çš„ç³»ç»Ÿæ–‡ä»¶äº†ã€‚(Ubuntu ä¹Ÿæ˜¯ GNU ç³»ç»Ÿçš„ä¸€ç§ï¼‰ ä½†è¦æ³¨æ„ä¸è¦åˆ æ‰ &lt;code>/tmp&lt;/code> , &lt;code>/dev&lt;/code> , &lt;code>/proc&lt;/code> , &lt;code>/run&lt;/code> , &lt;code>/sys&lt;/code> ã€‚å› ä¸º &lt;code>/tmp&lt;/code> é‡Œæœ‰ bootstrap è§£å‹åçš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨ä½¿ç”¨çš„ Arch Linux çš„ç³»ç»Ÿæ–‡ä»¶ï¼Œåé¢ 4 ä¸ªæ˜¯å†…æ ¸æ˜ å°„åˆ°æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½åˆ ï¼Œä½ ä¹Ÿå¯ä»¥ä¿ç•™ä½ çš„ &lt;code>/home&lt;/code> ç›®å½•ï¼Œå¦‚æœéœ€è¦ä¿ç•™å…¶ä»–æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œè®°å¾—å¤‡ä»½ï¼Œå› ä¸º arch åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šè¦†ç›–ã€‚&lt;/p>
&lt;p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸åˆ ï¼Œå®‰è£…å¥½ä¹‹åå†ç”¨ &lt;a href="https://wiki.archlinux.org/title/Pacman/Tips_and_tricks#Identify_files_not_owned_by_any_package">pacman åˆ—å‡ºæ¥&lt;/a>ï¼Œä¸è¦åœ¨æ”¹äº†é…ç½®ä¹‹åå†åˆ å“¦ï¼Œæœ‰äº›ç±»ä¼¼ &lt;code>/etc/hostname&lt;/code> æ˜¯ä¸è¢« &lt;code>pacman&lt;/code> è·Ÿè¸ªçš„&lt;/p>
&lt;pre class="shell">&lt;code># find /etc /usr /opt | LC_ALL=C pacman -Qqo - 2&amp;gt;&amp;amp;1 &amp;gt;&amp;amp;- &amp;gt;/dev/null | cut -d &amp;#39; &amp;#39; -f 5-&lt;/code>&lt;/pre>
&lt;h3 id="æŒ‰ç…§-installation-guideå®‰è£…-arch-linux">7. æŒ‰ç…§ &lt;a href="https://wiki.archlinux.org/title/Installation_guide_ï¼ˆç®€ä½“ä¸­æ–‡ï¼‰#å®‰è£…">Installation guide&lt;/a>ï¼Œå®‰è£… Arch Linuxã€‚&lt;/h3>
&lt;p>è¿™é‡Œåªæ˜¯æä¸€ä¸‹éœ€è¦å“ªäº›&lt;/p>
&lt;ol type="1">
&lt;li>&lt;p>å®‰è£…ï¼š&lt;code>pacstrap /mnt base linux linux-firmware&lt;/code>&lt;/p>&lt;/li>
&lt;li>&lt;p>åˆ†åŒºï¼š&lt;code>genfstab -U /mnt &amp;gt;&amp;gt; /mnt/etc/fstab&lt;/code>&lt;/p>&lt;/li>
&lt;li>&lt;p>&lt;code>arc:chroot /mnt&lt;/code>&lt;/p>&lt;/li>
&lt;li>&lt;p>æ—¶åŒºï¼š&lt;code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/code> , &lt;code>hwclock --systohc&lt;/code>&lt;/p>&lt;/li>
&lt;li>&lt;p>æ–‡å­—ç¼–ç ï¼š&lt;code>/etc/locale.gen&lt;/code> &lt;code>locale-gen&lt;/code>&lt;/p>&lt;/li>
&lt;li>&lt;p>grub:&lt;/p>&lt;/li>
&lt;/ol>
&lt;div class="sourceCode" id="cb9">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb9-1">&lt;a href="#cb9-1" aria-hidden="true">&lt;/a>&lt;span class="ex">pacman&lt;/span> -s intel-ucode&lt;/span>
&lt;span id="cb9-2">&lt;a href="#cb9-2" aria-hidden="true">&lt;/a>&lt;span class="ex">grub-install&lt;/span> --target=i386-pc /dev/vda&lt;/span>
&lt;span id="cb9-3">&lt;a href="#cb9-3" aria-hidden="true">&lt;/a>&lt;span class="ex">grub-mkconfig&lt;/span> -o /boot/grub/grub.cfg&lt;span class="kw">`&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;ol start="6" type="1">
&lt;li>ç½‘ç»œï¼š&lt;code>/etc/hostname&lt;/code> , &lt;code>/etc/hosts&lt;/code> , &lt;code>/etc/systemd/network/en.network&lt;/code> ï¼Œenable it&lt;/li>
&lt;/ol>
&lt;pre class="conf">&lt;code>[Match]
Name=en*
# arch æ˜¯ ens5 è¿™ç§çš„
# Ubuntu çš„ç½‘å¡åè¿˜æ˜¯ eth0
# ä¸æ”¾å¿ƒå¯ä»¥ç”¨ e*
[Network]
DHCP=ipv4&lt;/code>&lt;/pre>
&lt;ol start="8" type="1">
&lt;li>&lt;p>&lt;code>pacman -S neovim openssh sudo&lt;/code> , enable ssh&lt;/p>&lt;/li>
&lt;li>&lt;p>ç”¨æˆ·ã€å¯†ç ã€ &lt;code>sudo&lt;/code> : &lt;code>passwd&lt;/code> , &lt;code>useradd -a -G wheel ben&lt;/code> , &lt;code>passwd ben&lt;/code> , &lt;code>visudo&lt;/code>&lt;/p>&lt;/li>
&lt;/ol>
&lt;h3 id="é‡å¯">7. é‡å¯&lt;/h3>
&lt;p>å¦‚æœå¯åŠ¨å¤±è´¥å¯ä»¥é€šè¿‡ VNC çš„æ–¹å¼ç™»å½•ï¼Œå¯ä»¥çœ‹åˆ° grub ç­‰ç•Œé¢&lt;/p></description></item></channel></rss>