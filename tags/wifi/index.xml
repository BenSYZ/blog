<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>wifi on Ben's Blog</title><link>https://bensyz.github.io/blog/tags/wifi/</link><description>Recent content in wifi on Ben's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 31 Jul 2020 15:34:47 +0800</lastBuildDate><atom:link href="https://bensyz.github.io/blog/tags/wifi/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux开机自动连接网络</title><link>https://bensyz.github.io/blog/blogs/connect_wifi_on_startup/</link><pubDate>Wed, 26 Feb 2020 10:26:09 +0800</pubDate><guid>https://bensyz.github.io/blog/blogs/connect_wifi_on_startup/</guid><description>&lt;p>整合自: https://bbs.archlinux.org/viewtopic.php?id=178625&lt;/p>
&lt;p>上一篇&lt;a href="../connect_wifi_command">文章&lt;/a>讲到如何用命令行连接wifi，大家可以去看看。&lt;/p>
&lt;p>本文参考 &lt;a href="https://bbs.archlinux.org/viewtopic.php?id=178625">https://bbs.archlinux.org/viewtopic.php?id=178625&lt;/a> ## TL,DR&lt;/p>
&lt;h3 id="wpa_supplicant">&lt;code>wpa_supplicant&lt;/code>&lt;/h3>
&lt;div class="sourceCode" id="cb1">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb1-1">&lt;a href="#cb1-1" aria-hidden="true">&lt;/a>&lt;span class="co"># config wpa_supplicant&lt;/span>&lt;/span>
&lt;span id="cb1-2">&lt;a href="#cb1-2" aria-hidden="true">&lt;/a>&lt;span class="co">#/etc/wpa_supplicant/wpa_supplicant-wlp5s0.conf&lt;/span>&lt;/span>
&lt;span id="cb1-3">&lt;a href="#cb1-3" aria-hidden="true">&lt;/a>&lt;/span>
&lt;span id="cb1-4">&lt;a href="#cb1-4" aria-hidden="true">&lt;/a>&lt;span class="co"># enable wpa_supplicant&lt;/span>&lt;/span>
&lt;span id="cb1-5">&lt;a href="#cb1-5" aria-hidden="true">&lt;/a>&lt;span class="ex">systemctl&lt;/span> enable wpa_supplicant@wlp5s0&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h3 id="config-systemd-network">&lt;code>config systemd-network&lt;/code>&lt;/h3>
&lt;div class="sourceCode" id="cb2">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb2-1">&lt;a href="#cb2-1" aria-hidden="true">&lt;/a>&lt;span class="co"># config systemd-network&lt;/span>&lt;/span>
&lt;span id="cb2-2">&lt;a href="#cb2-2" aria-hidden="true">&lt;/a>&lt;span class="co"># /etc/systemd/network/00-wireless-dhcp.network&lt;/span>&lt;/span>
&lt;span id="cb2-3">&lt;a href="#cb2-3" aria-hidden="true">&lt;/a>[&lt;span class="ex">Match&lt;/span>]&lt;/span>
&lt;span id="cb2-4">&lt;a href="#cb2-4" aria-hidden="true">&lt;/a>&lt;span class="va">Name=&lt;/span>wlp5s0&lt;/span>
&lt;span id="cb2-5">&lt;a href="#cb2-5" aria-hidden="true">&lt;/a>&lt;/span>
&lt;span id="cb2-6">&lt;a href="#cb2-6" aria-hidden="true">&lt;/a>[&lt;span class="ex">Network&lt;/span>]&lt;/span>
&lt;span id="cb2-7">&lt;a href="#cb2-7" aria-hidden="true">&lt;/a>&lt;span class="va">DHCP=&lt;/span>yes&lt;/span>
&lt;span id="cb2-8">&lt;a href="#cb2-8" aria-hidden="true">&lt;/a>&lt;/span>
&lt;span id="cb2-9">&lt;a href="#cb2-9" aria-hidden="true">&lt;/a>&lt;span class="co"># enable systemd-networkd.service&lt;/span>&lt;/span>
&lt;span id="cb2-10">&lt;a href="#cb2-10" aria-hidden="true">&lt;/a>&lt;span class="ex">systemctl&lt;/span> enable systemd-networkd.service&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="需要工具">需要工具&lt;/h2>
&lt;ol type="1">
&lt;li>&lt;code>wpa_supplicant&lt;/code>&lt;/li>
&lt;li>&lt;code>dhcpcd&lt;/code>&lt;/li>
&lt;/ol>
&lt;h2 id="配置文件">配置文件&lt;/h2>
&lt;ol type="1">
&lt;li>&lt;p>&lt;code>/etc/wpa_supplicant/wpa_supplicant-网卡名.conf&lt;/code>&lt;/p>&lt;/li>
&lt;li>&lt;p>&lt;code>/etc/systemd/network/00-wireless-dhcp.network&lt;/code>&lt;/p>&lt;/li>
&lt;/ol>
&lt;h2 id="步骤">步骤&lt;/h2>
&lt;h3 id="wpa_supplicant-1">1. &lt;code>wpa_supplicant&lt;/code>&lt;/h3>
&lt;h4 id="查看网卡名字">1.1 查看网卡名字&lt;/h4>
&lt;div class="sourceCode" id="cb3">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb3-1">&lt;a href="#cb3-1" aria-hidden="true">&lt;/a>&lt;span class="ex">ip&lt;/span> link&lt;/span>
&lt;span id="cb3-2">&lt;a href="#cb3-2" aria-hidden="true">&lt;/a>&lt;span class="co"># 1: lo&lt;/span>&lt;/span>
&lt;span id="cb3-3">&lt;a href="#cb3-3" aria-hidden="true">&lt;/a>&lt;span class="co"># 2: enp4s0&lt;/span>&lt;/span>
&lt;span id="cb3-4">&lt;a href="#cb3-4" aria-hidden="true">&lt;/a>&lt;span class="co"># 3: wlp5s0&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;ol type="1">
&lt;li>lo 是loop设备&lt;/li>
&lt;li>enp4s0 是有线设备&lt;/li>
&lt;li>wlp5s0 是无线设备&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>注意我的网卡名是 &lt;code>wlp5s0&lt;/code>，下文中的&lt;code>wlp5s0&lt;/code> 都需替换成你的&lt;/strong>&lt;/p>
&lt;h4 id="生成-wpa_supplicant.conf文件">1.2 生成 &lt;code>wpa_supplicant.conf&lt;/code>文件&lt;/h4>
&lt;p>将生成的&lt;code>wpa_supplicant.conf&lt;/code> 放到&lt;code>/etc/wpa_supplicant/&lt;/code>文件夹下，并重命名，格式为：&lt;/p>
&lt;div class="sourceCode" id="cb4">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb4-1">&lt;a href="#cb4-1" aria-hidden="true">&lt;/a>&lt;span class="ex">wpa_supplicant-&lt;/span>网卡名.conf&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>例如我的就是：&lt;/p>
&lt;div class="sourceCode" id="cb5">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb5-1">&lt;a href="#cb5-1" aria-hidden="true">&lt;/a>&lt;span class="ex">wpa_supplicant-wlp5s0.conf&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h5 id="通过修改原始配置文件">通过修改原始配置文件&lt;/h5>
&lt;p>&lt;code>man wpa_supplicant.conf&lt;/code> 知道原始配置文件在&lt;/p>
&lt;div class="sourceCode" id="cb6">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb6-1">&lt;a href="#cb6-1" aria-hidden="true">&lt;/a>&lt;span class="ex">/usr/share/doc/wpa_supplicant/wpa_supplicant.conf&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h5 id="通过wpa_passphrase生成配置文件">通过&lt;code>wpa_passphrase&lt;/code>生成配置文件&lt;/h5>
&lt;div class="sourceCode" id="cb7">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb7-1">&lt;a href="#cb7-1" aria-hidden="true">&lt;/a>&lt;span class="co"># wpa_passphrase MyNetwork SuperSecretPassphrase &amp;gt; /etc/wpa_supplicant/wpa_supplicant-wlp5s0.conf&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h5 id="通过下面的格式">通过下面的格式&lt;/h5>
&lt;p>&lt;code>priority&lt;/code> 越大优先级越高&lt;/p>
&lt;div class="sourceCode" id="cb8">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb8-1">&lt;a href="#cb8-1" aria-hidden="true">&lt;/a>&lt;span class="va">country=&lt;/span>CN&lt;/span>
&lt;span id="cb8-2">&lt;a href="#cb8-2" aria-hidden="true">&lt;/a>&lt;span class="va">update_config=&lt;/span>1&lt;/span>
&lt;span id="cb8-3">&lt;a href="#cb8-3" aria-hidden="true">&lt;/a>&lt;span class="va">network=&lt;/span>&lt;span class="kw">{&lt;/span>&lt;/span>
&lt;span id="cb8-4">&lt;a href="#cb8-4" aria-hidden="true">&lt;/a> &lt;span class="va">ssid=&lt;/span>&lt;span class="st">&amp;quot;SSID&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb8-5">&lt;a href="#cb8-5" aria-hidden="true">&lt;/a> &lt;span class="va">psk=&lt;/span>&lt;span class="st">&amp;quot;Passwd&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb8-6">&lt;a href="#cb8-6" aria-hidden="true">&lt;/a> &lt;span class="va">key_mgmt=&lt;/span>WPA-PSK&lt;/span>
&lt;span id="cb8-7">&lt;a href="#cb8-7" aria-hidden="true">&lt;/a> &lt;span class="va">priority=&lt;/span>9&lt;/span>
&lt;span id="cb8-8">&lt;a href="#cb8-8" aria-hidden="true">&lt;/a> &lt;span class="va">id_str=&lt;/span>&lt;span class="st">&amp;quot;identify which wifi is&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb8-9">&lt;a href="#cb8-9" aria-hidden="true">&lt;/a>&lt;span class="kw">}&lt;/span>&lt;/span>
&lt;span id="cb8-10">&lt;a href="#cb8-10" aria-hidden="true">&lt;/a>&lt;/span>
&lt;span id="cb8-11">&lt;a href="#cb8-11" aria-hidden="true">&lt;/a>&lt;span class="va">network=&lt;/span>&lt;span class="kw">{&lt;/span>&lt;/span>
&lt;span id="cb8-12">&lt;a href="#cb8-12" aria-hidden="true">&lt;/a> &lt;span class="va">ssid=&lt;/span>&lt;span class="st">&amp;quot;SSID&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb8-13">&lt;a href="#cb8-13" aria-hidden="true">&lt;/a> &lt;span class="va">psk=&lt;/span>&lt;span class="st">&amp;quot;Passwd&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb8-14">&lt;a href="#cb8-14" aria-hidden="true">&lt;/a> &lt;span class="va">key_mgmt=&lt;/span>WPA-PSK&lt;/span>
&lt;span id="cb8-15">&lt;a href="#cb8-15" aria-hidden="true">&lt;/a> &lt;span class="va">priority=&lt;/span>8&lt;/span>
&lt;span id="cb8-16">&lt;a href="#cb8-16" aria-hidden="true">&lt;/a> &lt;span class="va">id_str=&lt;/span>&lt;span class="st">&amp;quot;identify which wifi is&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb8-17">&lt;a href="#cb8-17" aria-hidden="true">&lt;/a>&lt;span class="kw">}&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h4 id="用systemctl启动wpa_supplicant服务">1.3 用&lt;code>systemctl&lt;/code>启动&lt;code>wpa_supplicant&lt;/code>服务&lt;/h4>
&lt;div class="sourceCode" id="cb9">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb9-1">&lt;a href="#cb9-1" aria-hidden="true">&lt;/a>&lt;span class="ex">systemctl&lt;/span> enable wpa_supplicant@wlp5s0&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>&lt;strong>注意arch bbs 原回答多写了&lt;code>.conf&lt;/code>&lt;/strong>，后面也有跟帖指出了这个问题。&lt;/p>
&lt;h3 id="systemd-networkd">2. &lt;code>systemd-networkd&lt;/code>&lt;/h3>
&lt;h4 id="配置systemd-network的配置文件">2.1 配置systemd-network的&lt;a href="https://www.centos.bz/2018/05/systemd-%E7%9A%84%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86/">配置文件&lt;/a>&lt;/h4>
&lt;p>创建&lt;code>/etc/systemd/network/00-wireless-dhcp.network&lt;/code>，archbbs中说这个名字随意。&lt;/p>
&lt;pre>&lt;code>[Match]
Name=wlp5s0
[Network]
DHCP=yes&lt;/code>&lt;/pre>
&lt;h4 id="用systemctl设置启动服务systemd-networkd.service">2.2 用&lt;code>systemctl&lt;/code>设置启动服务&lt;code>systemd-networkd.service&lt;/code>&lt;/h4>
&lt;div class="sourceCode" id="cb11">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb11-1">&lt;a href="#cb11-1" aria-hidden="true">&lt;/a>&lt;span class="ex">systemctl&lt;/span> enable systemd-networkd.service&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;h2 id="回顾">回顾&lt;/h2>
&lt;p>在&lt;a href="#1.3">1.3&lt;/a>的&lt;code>systemctl enable wpa_supplicant@wlp5s0&lt;/code>中，我们看到：&lt;/p>
&lt;div class="sourceCode" id="cb12">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb12-1">&lt;a href="#cb12-1" aria-hidden="true">&lt;/a>&lt;span class="ex">Created&lt;/span> symlink /etc/systemd/system/multi-user.target.wants/wpa_supplicant@wlp5s0.service → /usr/lib/systemd/system/wpa_supplicant@.service.&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>查看&lt;code>/usr/lib/systemd/system/wpa_supplicant@.service&lt;/code>，其中有一行：&lt;/p>
&lt;div class="sourceCode" id="cb13">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb13-1">&lt;a href="#cb13-1" aria-hidden="true">&lt;/a>&lt;span class="va">ExecStart=&lt;/span>/usr/bin/wpa_supplicant &lt;span class="ex">-c/etc/wpa_supplicant/wpa_supplicant-%I.conf&lt;/span> -i%I&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>这里的&lt;code>%I&lt;/code> 就是&lt;code>systemctl enable wpa_supplicant@wlp5s0&lt;/code>中的&lt;code>wlp5s0&lt;/code>，它通过&lt;code>%I&lt;/code>来传递设备名，所以我们也就知道之前为什么要把配置文件这样命名了&lt;/p>
&lt;div class="sourceCode" id="cb14">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb14-1">&lt;a href="#cb14-1" aria-hidden="true">&lt;/a>&lt;span class="ex">/etc/wpa_supplicant&lt;/span>/&lt;span class="ex">wpa_supplicant-&lt;/span>网卡名.conf&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>