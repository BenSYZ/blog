<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>conda on Ben's Blog</title><link>https://bensyz.github.io/blog/tags/conda/</link><description>Recent content in conda on Ben's Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 19 Jun 2023 06:59:23 +0800</lastBuildDate><atom:link href="https://bensyz.github.io/blog/tags/conda/index.xml" rel="self" type="application/rss+xml"/><item><title>python virtual env and venv</title><link>https://bensyz.github.io/blog/blogs/python_virtual_env/</link><pubDate>Mon, 19 Jun 2023 06:59:23 +0800</pubDate><guid>https://bensyz.github.io/blog/blogs/python_virtual_env/</guid><description>&lt;p>pre introduction : stackoverflow &lt;a href="https://stackoverflow.com/a/41573588/13033234">what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe&lt;/a>&lt;/p>
&lt;p>原先位于 Tips write date: 2021-04-21T00:00:00+08:00&lt;/p>
&lt;h2 id="intro">intro&lt;/h2>
&lt;p>&lt;code>anaconda&lt;/code> 和 &lt;code>miniconda&lt;/code> 是很常用的多版本 python 的管理器，不过我有几点不满意&lt;/p>
&lt;ul>
&lt;li>过于庞大，不够轻量，即使是 miniconda 好像也有 好几百兆&lt;/li>
&lt;li>而且 conda channel 什么的整了好久都没整明白，&lt;/li>
&lt;li>已经有 pip 了为何还要用 conda install&lt;/li>
&lt;/ul>
&lt;p>当然 conda 还提供了一些非 python 的内容，这是 pip 无法做到的，但是这又和 kiss 原则相违背了。&lt;/p>
&lt;h2 id="softwares">softwares&lt;/h2>
&lt;ol type="1">
&lt;li>&lt;code>pyenv&lt;/code>: provide python version&lt;/li>
&lt;li>&lt;code>venv&lt;/code>: provide virtual environment&lt;/li>
&lt;/ol>
&lt;h2 id="working-flow-example">Working flow example&lt;/h2>
&lt;h3 id="configure">Configure&lt;/h3>
&lt;ol type="1">
&lt;li>install another version of python&lt;/li>
&lt;/ol>
&lt;p>2023-06-19 update:&lt;/p>
&lt;p>if you want to generate &lt;code>libpython3.so&lt;/code>&lt;/p>
&lt;div class="sourceCode" id="cb1">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb1-1">&lt;a href="#cb1-1" aria-hidden="true">&lt;/a>&lt;span class="fu">env&lt;/span> CONFIGURE_OPTS=&lt;span class="st">&amp;quot;--enable-shared&amp;quot;&lt;/span> pyenv install 3.10&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>2023-05-26 update:&lt;/p>
&lt;div class="sourceCode" id="cb2">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb2-1">&lt;a href="#cb2-1" aria-hidden="true">&lt;/a>&lt;span class="ex">pyenv&lt;/span> install --patch 3.7.9 &lt;span class="op">&amp;lt;&amp;lt; alignment.patch&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>&lt;a href="https://github.com/pyenv/pyenv-virtualenv/issues/410">alignment.patch src&lt;/a>&lt;/p>
&lt;div class="sourceCode" id="cb3">&lt;pre class="sourceCode diff">&lt;code class="sourceCode diff">&lt;span id="cb3-1">&lt;a href="#cb3-1" aria-hidden="true">&lt;/a>&lt;span class="kw">--- Include/objimpl.h&lt;/span>&lt;/span>
&lt;span id="cb3-2">&lt;a href="#cb3-2" aria-hidden="true">&lt;/a>&lt;span class="dt">+++ Include/objimpl.h&lt;/span>&lt;/span>
&lt;span id="cb3-3">&lt;a href="#cb3-3" aria-hidden="true">&lt;/a>&lt;span class="dt">@@ -250,7 +250,7 @@&lt;/span>&lt;/span>
&lt;span id="cb3-4">&lt;a href="#cb3-4" aria-hidden="true">&lt;/a> union _gc_head *gc_prev;&lt;/span>
&lt;span id="cb3-5">&lt;a href="#cb3-5" aria-hidden="true">&lt;/a> Py_ssize_t gc_refs;&lt;/span>
&lt;span id="cb3-6">&lt;a href="#cb3-6" aria-hidden="true">&lt;/a> } gc;&lt;/span>
&lt;span id="cb3-7">&lt;a href="#cb3-7" aria-hidden="true">&lt;/a>&lt;span class="st">- double dummy; /* force worst-case alignment */&lt;/span>&lt;/span>
&lt;span id="cb3-8">&lt;a href="#cb3-8" aria-hidden="true">&lt;/a>&lt;span class="va">+ long double dummy; /* force worst-case alignment */&lt;/span>&lt;/span>
&lt;span id="cb3-9">&lt;a href="#cb3-9" aria-hidden="true">&lt;/a> } PyGC_Head;&lt;/span>
&lt;span id="cb3-10">&lt;a href="#cb3-10" aria-hidden="true">&lt;/a>&lt;/span>
&lt;span id="cb3-11">&lt;a href="#cb3-11" aria-hidden="true">&lt;/a> extern PyGC_Head *_PyGC_generation0;&lt;/span>
&lt;span id="cb3-12">&lt;a href="#cb3-12" aria-hidden="true">&lt;/a>&lt;span class="kw">--- Objects/obmalloc.c&lt;/span>&lt;/span>
&lt;span id="cb3-13">&lt;a href="#cb3-13" aria-hidden="true">&lt;/a>&lt;span class="dt">+++ Objects/obmalloc.c&lt;/span>&lt;/span>
&lt;span id="cb3-14">&lt;a href="#cb3-14" aria-hidden="true">&lt;/a>&lt;span class="dt">@@ -643,8 +643,8 @@&lt;/span>&lt;/span>
&lt;span id="cb3-15">&lt;a href="#cb3-15" aria-hidden="true">&lt;/a> *&lt;/span>
&lt;span id="cb3-16">&lt;a href="#cb3-16" aria-hidden="true">&lt;/a> * You shouldn&amp;#39;t change this unless you know what you are doing.&lt;/span>
&lt;span id="cb3-17">&lt;a href="#cb3-17" aria-hidden="true">&lt;/a> */&lt;/span>
&lt;span id="cb3-18">&lt;a href="#cb3-18" aria-hidden="true">&lt;/a>&lt;span class="st">-#define ALIGNMENT 8 /* must be 2^N */&lt;/span>&lt;/span>
&lt;span id="cb3-19">&lt;a href="#cb3-19" aria-hidden="true">&lt;/a>&lt;span class="st">-#define ALIGNMENT_SHIFT 3&lt;/span>&lt;/span>
&lt;span id="cb3-20">&lt;a href="#cb3-20" aria-hidden="true">&lt;/a>&lt;span class="va">+#define ALIGNMENT 16 /* must be 2^N */&lt;/span>&lt;/span>
&lt;span id="cb3-21">&lt;a href="#cb3-21" aria-hidden="true">&lt;/a>&lt;span class="va">+#define ALIGNMENT_SHIFT 4&lt;/span>&lt;/span>
&lt;span id="cb3-22">&lt;a href="#cb3-22" aria-hidden="true">&lt;/a>&lt;/span>
&lt;span id="cb3-23">&lt;a href="#cb3-23" aria-hidden="true">&lt;/a> /* Return the number of bytes in size class I, as a uint. */&lt;/span>
&lt;span id="cb3-24">&lt;a href="#cb3-24" aria-hidden="true">&lt;/a> #define INDEX2SIZE(I) (((uint)(I) + 1) &amp;lt;&amp;lt; ALIGNMENT_SHIFT)&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;ol start="2" type="1">
&lt;li>Add that python to &lt;code>$PATH&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="sourceCode" id="cb4">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb4-1">&lt;a href="#cb4-1" aria-hidden="true">&lt;/a>&lt;span class="co"># default python be python 3.7.9&lt;/span>&lt;/span>
&lt;span id="cb4-2">&lt;a href="#cb4-2" aria-hidden="true">&lt;/a>&lt;span class="bu">export&lt;/span> &lt;span class="va">PYENV_ROOT=&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;span class="va">$HOME&lt;/span>&lt;span class="st">/.pyenv/versions/3.7.9/&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb4-3">&lt;a href="#cb4-3" aria-hidden="true">&lt;/a>&lt;span class="bu">export&lt;/span> &lt;span class="va">PATH=&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;span class="va">$PYENV_ROOT&lt;/span>&lt;span class="st">/bin:&lt;/span>&lt;span class="va">$PATH&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;ol start="3" type="1">
&lt;li>Create virtual environment, there will be python command in &lt;code>.venv/3.6/bin&lt;/code>, but it is a link to current &lt;code>python&lt;/code>.&lt;/li>
&lt;/ol>
&lt;div class="sourceCode" id="cb5">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb5-1">&lt;a href="#cb5-1" aria-hidden="true">&lt;/a>&lt;span class="co"># create virtual environment&lt;/span>&lt;/span>
&lt;span id="cb5-2">&lt;a href="#cb5-2" aria-hidden="true">&lt;/a>&lt;span class="bu">cd&lt;/span> ~/.venv&lt;/span>
&lt;span id="cb5-3">&lt;a href="#cb5-3" aria-hidden="true">&lt;/a>&lt;span class="ex">python&lt;/span> -m venv 3.7&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;ol start="4" type="1">
&lt;li>Active and deactivate it&lt;/li>
&lt;/ol>
&lt;div class="sourceCode" id="cb6">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb6-1">&lt;a href="#cb6-1" aria-hidden="true">&lt;/a>&lt;span class="bu">source&lt;/span> ~/.venv/3.7/bin/activate&lt;/span>
&lt;span id="cb6-2">&lt;a href="#cb6-2" aria-hidden="true">&lt;/a>&lt;span class="ex">deactivate&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>&lt;code>export&lt;/code> in the 2nd is no needed this time.&lt;/p>
&lt;h3 id="reuse">Reuse&lt;/h3>
&lt;p>Active and deactivate it&lt;/p>
&lt;div class="sourceCode" id="cb7">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb7-1">&lt;a href="#cb7-1" aria-hidden="true">&lt;/a>&lt;span class="bu">source&lt;/span> ~/.venv/3.6/bin/activate&lt;/span>
&lt;span id="cb7-2">&lt;a href="#cb7-2" aria-hidden="true">&lt;/a>&lt;span class="ex">deactivate&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>you can check if it’s enalbed by:&lt;/p>
&lt;pre>&lt;code>which python3
which pip3&lt;/code>&lt;/pre>
&lt;h3 id="others">others&lt;/h3>
&lt;p>Set pyenv as default, not recommend:&lt;/p>
&lt;div class="sourceCode" id="cb9">&lt;pre class="sourceCode sh">&lt;code class="sourceCode bash">&lt;span id="cb9-1">&lt;a href="#cb9-1" aria-hidden="true">&lt;/a>&lt;span class="co"># .zshrc&lt;/span>&lt;/span>
&lt;span id="cb9-2">&lt;a href="#cb9-2" aria-hidden="true">&lt;/a>&lt;span class="co"># pyenv&lt;/span>&lt;/span>
&lt;span id="cb9-3">&lt;a href="#cb9-3" aria-hidden="true">&lt;/a>&lt;span class="bu">export&lt;/span> &lt;span class="va">PYENV_ROOT=&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;span class="va">$HOME&lt;/span>&lt;span class="st">/.pyenv&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb9-4">&lt;a href="#cb9-4" aria-hidden="true">&lt;/a>&lt;span class="bu">export&lt;/span> &lt;span class="va">PATH=&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;span class="va">$PYENV_ROOT&lt;/span>&lt;span class="st">/bin:&lt;/span>&lt;span class="va">$PATH&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb9-5">&lt;a href="#cb9-5" aria-hidden="true">&lt;/a>&lt;span class="kw">if&lt;/span> &lt;span class="bu">command&lt;/span> -v pyenv &lt;span class="op">1&amp;gt;&lt;/span>/dev/null &lt;span class="op">2&amp;gt;&amp;amp;1&lt;/span>&lt;span class="kw">;&lt;/span> &lt;span class="kw">then&lt;/span>&lt;/span>
&lt;span id="cb9-6">&lt;a href="#cb9-6" aria-hidden="true">&lt;/a> &lt;span class="bu">eval&lt;/span> &lt;span class="st">&amp;quot;&lt;/span>&lt;span class="va">$(&lt;/span>&lt;span class="ex">pyenv&lt;/span> init -&lt;span class="va">)&lt;/span>&lt;span class="st">&amp;quot;&lt;/span>&lt;/span>
&lt;span id="cb9-7">&lt;a href="#cb9-7" aria-hidden="true">&lt;/a>&lt;span class="kw">fi&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>